{"version":3,"file":"tinybind.esm.js","sources":["../src/constants.js","../src/parsers.js","../src/tinybind.js","../src/observer.js","../src/bindings.js","../src/view.js","../src/adapter.js","../src/binders.js","../src/export.js"],"sourcesContent":["export const OPTIONS = [\r\n  'prefix',\r\n  'templateDelimiters',\r\n  'rootInterface',\r\n  'preloadData',\r\n  'handler'\r\n]\r\n\r\nexport const EXTENSIONS = [\r\n  'binders',\r\n  'formatters',\r\n  'adapters'\r\n]","const PRIMITIVE = 0\r\nconst KEYPATH = 1\r\nconst TEXT = 0\r\nconst BINDING = 1\r\n\r\nconst QUOTED_STR = /^'.*'$|^\".*\"$/\r\n\r\n// Parser and tokenizer for getting the type and value from a string.\r\nexport function parseType(string) {\r\n  let type = PRIMITIVE\r\n  let value = string\r\n\r\n  if (QUOTED_STR.test(string)) {\r\n    value = string.slice(1, -1)\r\n  } else if (string === 'true') {\r\n    value = true\r\n  } else if (string === 'false') {\r\n    value = false\r\n  } else if (string === 'null') {\r\n    value = null\r\n  } else if (string === 'undefined') {\r\n    value = undefined\r\n  } else if (!isNaN(string)) {\r\n    value = Number(string)\r\n  } else {\r\n    type = KEYPATH\r\n  }\r\n\r\n  return {type: type, value: value}\r\n}\r\n\r\n// Template parser and tokenizer for mustache-style text content bindings.\r\n// Parses the template and returns a set of tokens, separating static portions\r\n// of text from binding declarations.\r\nexport function parseTemplate(template, delimiters) {\r\n  var tokens\r\n  let length = template.length\r\n  let index = 0\r\n  let lastIndex = 0\r\n  let open = delimiters[0], close = delimiters[1]\r\n\r\n  while (lastIndex < length) {\r\n    index = template.indexOf(open, lastIndex)\r\n\r\n    if (index < 0) {\r\n      if (tokens) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex)\r\n        })\r\n      }\r\n\r\n      break\r\n    } else {\r\n      tokens || (tokens = [])\r\n      if (index > 0 && lastIndex < index) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex, index)\r\n        })\r\n      }\r\n\r\n      lastIndex = index + open.length\r\n      index = template.indexOf(close, lastIndex)\r\n\r\n      if (index < 0) {\r\n        let substring = template.slice(lastIndex - close.length)\r\n        let lastToken = tokens[tokens.length - 1]\r\n\r\n        if (lastToken && lastToken.type === TEXT) {\r\n          lastToken.value += substring\r\n        } else {\r\n          tokens.push({\r\n            type: TEXT,\r\n            value: substring\r\n          })\r\n        }\r\n\r\n        break\r\n      }\r\n\r\n      let value = template.slice(lastIndex, index).trim()\r\n\r\n      tokens.push({\r\n        type: BINDING,\r\n        value: value\r\n      })\r\n\r\n      lastIndex = index + close.length\r\n    }\r\n  }\r\n\r\n  return tokens\r\n}\r\n","import {EXTENSIONS} from './constants'\r\nimport {parseTemplate, parseType} from './parsers'\r\n\r\nconst tinybind = {\r\n  // Global binders.\r\n  binders: {},\r\n\r\n  // Global formatters.\r\n  formatters: {},\r\n\r\n  // Global sightglass adapters.\r\n  adapters: {},\r\n\r\n  // Default attribute prefix.\r\n  _prefix: 'rv',\r\n\r\n  _fullPrefix: 'rv-',\r\n\r\n  get prefix () {\r\n    return this._prefix\r\n  },\r\n\r\n  set prefix (value) {\r\n    this._prefix = value\r\n    this._fullPrefix = value + '-'\r\n  },\r\n\r\n  parseTemplate: parseTemplate,\r\n\r\n  parseType: parseType,\r\n\r\n  // Default template delimiters.\r\n  templateDelimiters: ['{', '}'],\r\n\r\n  // Default sightglass root interface.\r\n  rootInterface: '.',\r\n\r\n  // Preload data by default.\r\n  preloadData: true,\r\n\r\n  // Default event handler.\r\n  handler: function(context, ev, binding) {\r\n    this.call(context, ev, binding.view.models)\r\n  },\r\n\r\n  // Sets the attribute on the element. If no binder above is matched it will fall\r\n  // back to using this binder.\r\n  fallbackBinder: function(el, value) {\r\n    if (value != null) {\r\n      el.setAttribute(this.type, value)\r\n    } else {\r\n      el.removeAttribute(this.type)\r\n    }  \r\n  },\r\n\r\n  // Merges an object literal into the corresponding global options.\r\n  configure: function(options) {\r\n    if (!options) {\r\n      return\r\n    }\r\n    Object.keys(options).forEach(option => {\r\n      let value = options[option]\r\n\r\n      if (EXTENSIONS.indexOf(option) > -1) {\r\n        Object.keys(value).forEach(key => {\r\n          this[option][key] = value[key]\r\n        })\r\n      } else {\r\n        this[option] = value\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport default tinybind\r\n","\r\n// Check if a value is an object than can be observed.\r\nfunction isObject(obj) {\r\n  return typeof obj === 'object' && obj !== null\r\n}\r\n\r\n// Error thrower.\r\nfunction error(message) {\r\n  throw new Error('[Observer] ' + message)\r\n}\r\n\r\nvar adapters\r\nvar interfaces\r\nvar rootInterface\r\n\r\n// Constructs a new keypath observer and kicks things off.\r\nfunction Observer(obj, keypath, callback) {\r\n  this.keypath = keypath\r\n  this.callback = callback\r\n  this.objectPath = []\r\n  this.parse()\r\n  this.obj = this.getRootObject(obj)\r\n\r\n  if (isObject(this.target = this.realize())) {\r\n    this.set(true, this.key, this.target, this.callback)\r\n  }\r\n}\r\n\r\nObserver.updateOptions = function(options) {\r\n  adapters = options.adapters\r\n  interfaces = Object.keys(adapters)\r\n  rootInterface = options.rootInterface\r\n}\r\n\r\n// Tokenizes the provided keypath string into interface + path tokens for the\r\n// observer to work with.\r\nObserver.tokenize = function(keypath, root) {\r\n  var tokens = []\r\n  var current = {i: root, path: ''}\r\n  var index, chr\r\n\r\n  for (index = 0; index < keypath.length; index++) {\r\n    chr = keypath.charAt(index)\r\n\r\n    if (!!~interfaces.indexOf(chr)) {\r\n      tokens.push(current)\r\n      current = {i: chr, path: ''}\r\n    } else {\r\n      current.path += chr\r\n    }\r\n  }\r\n\r\n  tokens.push(current)\r\n  return tokens\r\n}\r\n\r\n// Parses the keypath using the interfaces defined on the view. Sets variables\r\n// for the tokenized keypath as well as the end key.\r\nObserver.prototype.parse = function() {\r\n  var path, root\r\n\r\n  if (!interfaces.length) {\r\n    error('Must define at least one adapter interface.')\r\n  }\r\n\r\n  if (!!~interfaces.indexOf(this.keypath[0])) {\r\n    root = this.keypath[0]\r\n    path = this.keypath.substr(1)\r\n  } else {\r\n    root = rootInterface\r\n    path = this.keypath\r\n  }\r\n\r\n  this.tokens = Observer.tokenize(path, root)\r\n  this.key = this.tokens.pop()\r\n}\r\n\r\n// Realizes the full keypath, attaching observers for every key and correcting\r\n// old observers to any changed objects in the keypath.\r\nObserver.prototype.realize = function() {\r\n  var current = this.obj\r\n  var unreached = -1\r\n  var prev\r\n  var token\r\n\r\n  for (let index = 0; index < this.tokens.length; index++) {\r\n    token = this.tokens[index]\r\n    if (isObject(current)) {\r\n      if (typeof this.objectPath[index] !== 'undefined') {\r\n        if (current !== (prev = this.objectPath[index])) {\r\n          this.set(false, token, prev, this)\r\n          this.set(true, token, current, this)\r\n          this.objectPath[index] = current\r\n        }\r\n      } else {\r\n        this.set(true, token, current, this)\r\n        this.objectPath[index] = current\r\n      }\r\n\r\n      current = this.get(token, current)\r\n    } else {\r\n      if (unreached === -1) {\r\n        unreached = index\r\n      }\r\n\r\n      if (prev = this.objectPath[index]) {\r\n        this.set(false, token, prev, this)\r\n      }\r\n    }\r\n  }\r\n\r\n  if (unreached !== -1) {\r\n    this.objectPath.splice(unreached)\r\n  }\r\n\r\n  return current\r\n}\r\n\r\n// Updates the keypath. This is called when any intermediary key is changed.\r\nObserver.prototype.sync = function() {\r\n  var next, oldValue, newValue\r\n\r\n  if ((next = this.realize()) !== this.target) {\r\n    if (isObject(this.target)) {\r\n      this.set(false, this.key, this.target, this.callback)\r\n    }\r\n\r\n    if (isObject(next)) {\r\n      this.set(true, this.key, next, this.callback)\r\n    }\r\n\r\n    oldValue = this.value()\r\n    this.target = next\r\n    newValue = this.value()\r\n    if (newValue !== oldValue || newValue instanceof Function) this.callback.sync()\r\n  } else if (next instanceof Array) {\r\n    this.callback.sync()\r\n  }\r\n}\r\n\r\n// Reads the current end value of the observed keypath. Returns undefined if\r\n// the full keypath is unreachable.\r\nObserver.prototype.value = function() {\r\n  if (isObject(this.target)) {\r\n    return this.get(this.key, this.target)\r\n  }\r\n}\r\n\r\n// Sets the current end value of the observed keypath. Calling setValue when\r\n// the full keypath is unreachable is a no-op.\r\nObserver.prototype.setValue = function(value) {\r\n  if (isObject(this.target)) {\r\n    adapters[this.key.i].set(this.target, this.key.path, value)\r\n  }\r\n}\r\n\r\n// Gets the provided key on an object.\r\nObserver.prototype.get = function(key, obj) {\r\n  return adapters[key.i].get(obj, key.path)\r\n}\r\n\r\n// Observes or unobserves a callback on the object using the provided key.\r\nObserver.prototype.set = function(active, key, obj, callback) {\r\n  var action = active ? 'observe' : 'unobserve'\r\n  adapters[key.i][action](obj, key.path, callback)\r\n}\r\n\r\n\r\n// Unobserves the entire keypath.\r\nObserver.prototype.unobserve = function() {\r\n  var obj\r\n  var token\r\n\r\n  for (let index = 0; index < this.tokens.length; index++) {\r\n    token = this.tokens[index]\r\n    if (obj = this.objectPath[index]) {\r\n      this.set(false, token, obj, this)\r\n    }\r\n  }\r\n\r\n  if (isObject(this.target)) {\r\n    this.set(false, this.key, this.target, this.callback)\r\n  }\r\n}\r\n// traverse the scope chain to find the scope which has the root property\r\n// if the property is not found in chain, returns the root scope\r\nObserver.prototype.getRootObject = function (obj) {\r\n  var rootProp, current;\r\n  if (!obj.$parent) {\r\n    return obj;\r\n  }\r\n\r\n  if (this.tokens.length) {\r\n    rootProp = this.tokens[0].path\r\n  } else {\r\n    rootProp = this.key.path\r\n  }\r\n\r\n  current = obj;\r\n  while (current.$parent && (current[rootProp] === undefined)) {\r\n    current = current.$parent\r\n  }\r\n\r\n  return current;\r\n}\r\n\r\nexport default Observer\r\n","import {parseType} from './parsers'\r\nimport Observer from './observer'\r\n\r\nfunction getInputValue(el) {\r\n  let results = []\r\n  if (el.type === 'checkbox') {\r\n    return el.checked\r\n  } else if (el.type === 'select-multiple') {\r\n\r\n    el.options.forEach(option => {\r\n      if (option.selected) {\r\n        results.push(option.value)\r\n      }\r\n    })\r\n\r\n    return results\r\n  } else {\r\n    return el.value\r\n  }\r\n}\r\n\r\nconst FORMATTER_ARGS =  /[^\\s']+|'([^']|'[^\\s])*'|\"([^\"]|\"[^\\s])*\"/g\r\nconst FORMATTER_SPLIT = /\\s+/\r\n\r\n// A single binding between a model attribute and a DOM element.\r\nexport class Binding {\r\n  // All information about the binding is passed into the constructor; the\r\n  // containing view, the DOM node, the type of binding, the model object and the\r\n  // keypath at which to listen for changes.\r\n  constructor(view, el, type, keypath, binder, arg, formatters) {\r\n    this.view = view\r\n    this.el = el\r\n    this.type = type\r\n    this.keypath = keypath\r\n    this.binder = binder\r\n    this.arg = arg\r\n    this.formatters = formatters\r\n    this.formatterObservers = {}\r\n    this.model = undefined\r\n  }\r\n\r\n  // Observes the object keypath\r\n  observe(obj, keypath) {\r\n    return new Observer(obj, keypath, this)\r\n  }\r\n\r\n  parseTarget() {\r\n    if (this.keypath) {\r\n      let token = parseType(this.keypath)\r\n\r\n      if (token.type === 0) {\r\n        this.value = token.value\r\n      } else {\r\n        this.observer = this.observe(this.view.models, this.keypath)\r\n        this.model = this.observer.target\r\n      }\r\n    } else {\r\n      this.value = undefined;\r\n    }\r\n  }\r\n\r\n  parseFormatterArguments(args, formatterIndex) {\r\n    return args\r\n      .map(parseType)\r\n      .map(({type, value}, ai) => {\r\n        if (type === 0) {\r\n          return value\r\n        } else {\r\n          if (!this.formatterObservers[formatterIndex]) {\r\n            this.formatterObservers[formatterIndex] = {}\r\n          }\r\n\r\n          let observer = this.formatterObservers[formatterIndex][ai]\r\n\r\n          if (!observer) {\r\n            observer = this.observe(this.view.models, value)\r\n            this.formatterObservers[formatterIndex][ai] = observer\r\n          }\r\n\r\n          return observer.value()\r\n        }\r\n      })\r\n  }\r\n\r\n  // Applies all the current formatters to the supplied value and returns the\r\n  // formatted value.\r\n  formattedValue(value) {\r\n    return this.formatters.reduce((result, declaration, index) => {\r\n      let args = declaration.match(FORMATTER_ARGS)\r\n      let id = args.shift()\r\n      let formatter = this.view.options.formatters[id]\r\n\r\n      const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n      if (formatter && (formatter.read instanceof Function)) {\r\n        result = formatter.read(result, ...processedArgs)\r\n      } else if (formatter instanceof Function) {\r\n        result = formatter(result, ...processedArgs)\r\n      }\r\n      return result\r\n    }, value)\r\n  }\r\n\r\n  // Returns an event handler for the binding around the supplied function.\r\n  eventHandler(fn) {\r\n    let binding = this\r\n    let handler = binding.view.options.handler\r\n\r\n    return function(ev) {\r\n      handler.call(fn, this, ev, binding)\r\n    }\r\n  }\r\n\r\n  // Sets the value for the binding. This Basically just runs the binding routine\r\n  // with the supplied value formatted.\r\n  set(value) {\r\n    if ((value instanceof Function) && !this.binder.function) {\r\n      value = this.formattedValue(value.call(this.model))\r\n    } else {\r\n      value = this.formattedValue(value)\r\n    }\r\n\r\n    let routineFn = this.binder.routine || this.binder\r\n\r\n    if (routineFn instanceof Function) {\r\n      routineFn.call(this, this.el, value)\r\n    }\r\n  }\r\n\r\n  // Syncs up the view binding with the model.\r\n  sync() {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n      this.set(this.observer.value())\r\n    } else {\r\n      this.set(this.value)\r\n    }\r\n  }\r\n\r\n  // Publishes the value currently set on the input element back to the model.\r\n  publish() {\r\n    if (this.observer) {\r\n      var value = this.formatters.reduceRight((result, declaration, index) => {\r\n        const args = declaration.split(FORMATTER_SPLIT)\r\n        const id = args.shift()\r\n        const formatter = this.view.options.formatters[id]\r\n        const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n        if (formatter && formatter.publish) {\r\n          result = formatter.publish(result, ...processedArgs)\r\n        }\r\n        return result\r\n      }, this.getValue(this.el))\r\n\r\n      this.observer.setValue(value)\r\n    }\r\n  }\r\n\r\n  // Subscribes to the model for changes at the specified keypath. Bi-directional\r\n  // routines will also listen for changes on the element to propagate them back\r\n  // to the model.\r\n  bind() {\r\n    this.parseTarget()\r\n\r\n    if (this.binder.hasOwnProperty('bind')) {\r\n      this.binder.bind.call(this, this.el)\r\n    }\r\n\r\n    if (this.view.options.preloadData) {\r\n      this.sync()\r\n    }\r\n  }\r\n\r\n  // Unsubscribes from the model and the element.\r\n  unbind() {\r\n    if (this.binder.unbind) {\r\n      this.binder.unbind.call(this, this.el)\r\n    }\r\n\r\n    if (this.observer) {\r\n      this.observer.unobserve()\r\n    }\r\n\r\n    Object.keys(this.formatterObservers).forEach(fi => {\r\n      let args = this.formatterObservers[fi]\r\n\r\n      Object.keys(args).forEach(ai => {\r\n        args[ai].unobserve()\r\n      })\r\n    })\r\n\r\n    this.formatterObservers = {}\r\n  }\r\n\r\n  // Updates the binding's model from what is currently set on the view. Unbinds\r\n  // the old model first and then re-binds with the new model.\r\n  update(models = {}) {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n    }\r\n\r\n    if (this.binder.update) {\r\n      this.binder.update.call(this, models)\r\n    }\r\n  }\r\n\r\n  // Returns elements value\r\n  getValue(el) {\r\n    if (this.binder && this.binder.getValue) {\r\n      return this.binder.getValue.call(this, el)\r\n    } else {\r\n      return getInputValue(el)\r\n    }\r\n  }\r\n}\r\n","import tinybind from './tinybind'\r\nimport {Binding} from './bindings'\r\nimport {parseTemplate} from './parsers'\r\n\r\nconst textBinder = {\r\n  routine: (node, value) => {\r\n    node.data = (value != null) ? value : ''\r\n  }\r\n}\r\n\r\nconst DECLARATION_SPLIT = /((?:'[^']*')*(?:(?:[^\\|']*(?:'[^']*')+[^\\|']*)+|[^\\|]+))|^$/g\r\n\r\nconst parseNode = (view, node) => {\r\n  let block = false\r\n\r\n  if (node.nodeType === 3) {\r\n    let tokens = parseTemplate(node.data, tinybind.templateDelimiters)\r\n\r\n    if (tokens) {\r\n      for (let i = 0; i < tokens.length; i++) {\r\n        let token = tokens[i]\r\n        let text = document.createTextNode(token.value)\r\n        node.parentNode.insertBefore(text, node)\r\n\r\n        if (token.type === 1) {\r\n          view.buildBinding(text, null, token.value, textBinder, null)\r\n        }\r\n      }\r\n\r\n      node.parentNode.removeChild(node)\r\n    }\r\n    block = true\r\n  } else if (node.nodeType === 1) {\r\n    block = view.traverse(node)\r\n  }\r\n\r\n  if (!block) {\r\n    for (let i = 0; i < node.childNodes.length; i++) {\r\n      parseNode(view, node.childNodes[i]);\r\n    }\r\n  }\r\n}\r\n\r\nconst bindingComparator = (a, b) => {\r\n  let aPriority = a.binder ? (a.binder.priority || 0) : 0\r\n  let bPriority = b.binder ? (b.binder.priority || 0) : 0\r\n  return bPriority - aPriority\r\n}\r\n\r\nconst trimStr = (str) => {\r\n  return str.trim()\r\n}\r\n\r\n// A collection of bindings built from a set of parent nodes.\r\nexport default class View {\r\n  // The DOM elements and the model objects for binding are passed into the\r\n  // constructor along with any local options that should be used throughout the\r\n  // context of the view and it's bindings.\r\n  constructor(els, models, options) {\r\n    if (els.jquery || els instanceof Array) {\r\n      this.els = els\r\n    } else {\r\n      this.els = [els]\r\n    }\r\n\r\n    this.models = models\r\n    this.options = options\r\n\r\n    this.build()\r\n  }\r\n\r\n\r\n  buildBinding(node, type, declaration, binder, arg) {\r\n    let pipes = declaration.match(DECLARATION_SPLIT).map(trimStr)\r\n\r\n    let keypath = pipes.shift()\r\n\r\n    this.bindings.push(new Binding(this, node, type, keypath, binder, arg, pipes))\r\n  }\r\n\r\n  // Parses the DOM tree and builds `Binding` instances for every matched\r\n  // binding declaration.\r\n  build() {\r\n    this.bindings = []\r\n\r\n    let elements = this.els, i, len;\r\n    for (i = 0, len = elements.length; i < len; i++) {\r\n      parseNode(this, elements[i])\r\n    }\r\n\r\n    this.bindings.sort(bindingComparator)\r\n  }\r\n\r\n  traverse(node) {\r\n    let bindingPrefix = tinybind._fullPrefix\r\n    let block = node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE'\r\n    let attributes = node.attributes\r\n    let bindInfos = []\r\n    let starBinders = this.options.starBinders\r\n    var type, binder, identifier, arg\r\n\r\n\r\n    for (let i = 0, len = attributes.length; i < len; i++) {\r\n      let attribute = attributes[i]\r\n      if (attribute.name.indexOf(bindingPrefix) === 0) {\r\n        type = attribute.name.slice(bindingPrefix.length)\r\n        binder = this.options.binders[type]\r\n        arg = undefined\r\n\r\n        if (!binder) {\r\n          for (let k = 0; k < starBinders.length; k++) {\r\n            identifier = starBinders[k]\r\n            if (type.slice(0, identifier.length - 1) === identifier.slice(0, -1)) {\r\n              binder = this.options.binders[identifier]\r\n              arg = type.slice(identifier.length - 1)\r\n              break\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!binder) {\r\n          binder = tinybind.fallbackBinder\r\n        }\r\n\r\n        if (binder.block) {\r\n          this.buildBinding(node, type, attribute.value, binder, arg)\r\n          node.removeAttribute(attribute.name)\r\n          return true;\r\n        }\r\n\r\n        bindInfos.push({attr: attribute, binder: binder, type: type, arg: arg})\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < bindInfos.length; i++) {\r\n      let bindInfo = bindInfos[i]\r\n      this.buildBinding(node, bindInfo.type, bindInfo.attr.value, bindInfo.binder, bindInfo.arg)\r\n      node.removeAttribute(bindInfo.attr.name)\r\n    }\r\n\r\n    return block\r\n  }\r\n\r\n  // Binds all of the current bindings for this view.\r\n  bind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.bind()\r\n    })\r\n  }\r\n\r\n  // Unbinds all of the current bindings for this view.\r\n  unbind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.unbind()\r\n    })\r\n  }\r\n\r\n  // Syncs up the view with the model by running the routines on all bindings.\r\n  sync() {\r\n    this.bindings.forEach(binding => {\r\n      binding.sync()\r\n    })\r\n  }\r\n\r\n  // Publishes the input values from the view back to the model (reverse sync).\r\n  publish() {\r\n    this.bindings.forEach(binding => {\r\n      if (binding.binder && binding.binder.publishes) {\r\n        binding.publish()\r\n      }\r\n    })\r\n  }\r\n\r\n  // Updates the view's models along with any affected bindings.\r\n  update(models = {}) {\r\n    Object.keys(models).forEach(key => {\r\n      this.models[key] = models[key]\r\n    })\r\n\r\n    this.bindings.forEach(binding => {\r\n      if (binding.update) {\r\n        binding.update(models)\r\n      }\r\n    })\r\n  }\r\n}\r\n","// The default `.` adapter that comes with tinybind.js. Allows subscribing to\r\n// properties on plain objects, implemented in ES5 natives using\r\n// `Object.defineProperty`.\r\n\r\nconst ARRAY_METHODS = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'sort',\r\n  'reverse',\r\n  'splice'\r\n]\r\n\r\nconst adapter = {\r\n  counter: 0,\r\n  weakmap: {},\r\n\r\n  weakReference: function(obj) {\r\n    if (!obj.hasOwnProperty('__rv')) {\r\n      let id = this.counter++\r\n\r\n      Object.defineProperty(obj, '__rv', {\r\n        value: id\r\n      })\r\n    }\r\n\r\n    if (!this.weakmap[obj.__rv]) {\r\n      this.weakmap[obj.__rv] = {\r\n        callbacks: {}\r\n      }\r\n    }\r\n\r\n    return this.weakmap[obj.__rv]\r\n  },\r\n\r\n  cleanupWeakReference: function(ref, id) {\r\n    if (!Object.keys(ref.callbacks).length) {\r\n      if (!(ref.pointers && Object.keys(ref.pointers).length)) {\r\n        delete this.weakmap[id]\r\n      }\r\n    }\r\n  },\r\n\r\n  stubFunction: function(obj, fn) {\r\n    let original = obj[fn]\r\n    let map = this.weakReference(obj)\r\n    let weakmap = this.weakmap\r\n\r\n    obj[fn] = (...args) => {\r\n      let response = original.apply(obj, args)\r\n\r\n      Object.keys(map.pointers).forEach(r => {\r\n        let k = map.pointers[r]\r\n\r\n        if (weakmap[r]) {\r\n          if (weakmap[r].callbacks[k] instanceof Array) {\r\n            weakmap[r].callbacks[k].forEach(callback => {\r\n              callback.sync()\r\n            })\r\n          }\r\n        }\r\n      })\r\n\r\n      return response\r\n    }\r\n  },\r\n\r\n  observeMutations: function(obj, ref, keypath) {\r\n    if (obj instanceof Array) {\r\n      let map = this.weakReference(obj)\r\n\r\n      if (!map.pointers) {\r\n        map.pointers = {}\r\n\r\n        ARRAY_METHODS.forEach(fn => {\r\n          this.stubFunction(obj, fn)\r\n        })\r\n      }\r\n\r\n      if (!map.pointers[ref]) {\r\n        map.pointers[ref] = []\r\n      }\r\n\r\n      if (map.pointers[ref].indexOf(keypath) === -1) {\r\n        map.pointers[ref].push(keypath)\r\n      }\r\n    }\r\n  },\r\n\r\n  unobserveMutations: function(obj, ref, keypath) {\r\n    if ((obj instanceof Array) && (obj.__rv != null)) {\r\n      let map = this.weakmap[obj.__rv]\r\n\r\n      if (map) {\r\n        let pointers = map.pointers[ref]\r\n\r\n        if (pointers) {\r\n          let idx = pointers.indexOf(keypath)\r\n\r\n          if (idx > -1) {\r\n            pointers.splice(idx, 1)\r\n          }\r\n\r\n          if (!pointers.length) {\r\n            delete map.pointers[ref]\r\n          }\r\n\r\n          this.cleanupWeakReference(map, obj.__rv)\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  observe: function(obj, keypath, callback) {\r\n    var value;\r\n    let callbacks = this.weakReference(obj).callbacks\r\n\r\n    if (!callbacks[keypath]) {\r\n      callbacks[keypath] = []\r\n      let desc = Object.getOwnPropertyDescriptor(obj, keypath)\r\n\r\n      if (!desc || !(desc.get || desc.set || !desc.configurable)) {\r\n        value = obj[keypath]\r\n\r\n        Object.defineProperty(obj, keypath, {\r\n          enumerable: true,\r\n\r\n          get: () => {\r\n            return value\r\n          },\r\n\r\n          set: newValue => {\r\n            if (newValue !== value) {\r\n              this.unobserveMutations(value, obj.__rv, keypath)\r\n              value = newValue\r\n              let map = this.weakmap[obj.__rv]\r\n\r\n              if (map) {\r\n                let callbacks = map.callbacks[keypath]\r\n\r\n                if (callbacks) {\r\n                  callbacks.forEach(cb => {\r\n                      cb.sync()\r\n                  })\r\n                }\r\n\r\n                this.observeMutations(newValue, obj.__rv, keypath)\r\n              }\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    if (callbacks[keypath].indexOf(callback) === -1) {\r\n      callbacks[keypath].push(callback)\r\n    }\r\n\r\n    this.observeMutations(obj[keypath], obj.__rv, keypath)\r\n  },\r\n\r\n  unobserve: function(obj, keypath, callback) {\r\n    let map = this.weakmap[obj.__rv]\r\n\r\n    if (map) {\r\n      let callbacks = map.callbacks[keypath]\r\n\r\n      if (callbacks) {\r\n        let idx = callbacks.indexOf(callback)\r\n\r\n        if (idx > -1) {\r\n          callbacks.splice(idx, 1)\r\n\r\n          if (!callbacks.length) {\r\n            delete map.callbacks[keypath]\r\n            this.unobserveMutations(obj[keypath], obj.__rv, keypath)\r\n          }\r\n        }\r\n\r\n        this.cleanupWeakReference(map, obj.__rv)\r\n      }\r\n    }\r\n  },\r\n\r\n  get: function(obj, keypath) {\r\n    return obj[keypath]\r\n  },\r\n\r\n  set: (obj, keypath, value) => {\r\n    obj[keypath] = value\r\n  }\r\n}\r\n\r\nexport default adapter\r\n","import View from './view'\r\n\r\nconst getString = (value) => {\r\n  return value != null ? value.toString() : undefined\r\n}\r\n\r\nconst times = (n, cb) => {\r\n  for (let i = 0; i < n; i++) cb()\r\n}\r\n\r\nfunction createView(binding, data, anchorEl) {\r\n  let template = binding.el.cloneNode(true)\r\n  let view = new View(template, data, binding.view.options)\r\n  view.bind()\r\n  binding.marker.parentNode.insertBefore(template, anchorEl)\r\n  return view\r\n}\r\n\r\nconst binders = {\r\n  // Binds an event handler on the element.\r\n  'on-*': {\r\n    function: true,\r\n    priority: 1000,\r\n\r\n    unbind: function(el) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n\r\n      this.handler = this.eventHandler(value)\r\n      el.addEventListener(this.arg, this.handler)\r\n    }\r\n  },\r\n\r\n  // Appends bound instances of the element in place for each item in the array.\r\n  'each-*': {\r\n    block: true,\r\n\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(` tinybind: ${this.type} `)\r\n        this.iterated = []\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else {\r\n        this.iterated.forEach(view => {\r\n          view.bind()\r\n        })\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (this.iterated) {\r\n        this.iterated.forEach(view => {\r\n          view.unbind()\r\n        })\r\n      }\r\n    },\r\n\r\n    routine: function(el, collection) {\r\n      let modelName = this.arg\r\n      collection = collection || []\r\n      let indexProp = el.getAttribute('index-property') || '$index'\r\n\r\n      collection.forEach((model, index) => {\r\n        let data = {$parent: this.view.models}\r\n        data[indexProp] = index\r\n        data[modelName] = model\r\n        let view = this.iterated[index]\r\n\r\n        if (!view) {\r\n\r\n          let previous = this.marker\r\n\r\n          if (this.iterated.length) {\r\n            previous = this.iterated[this.iterated.length - 1].els[0]\r\n          }\r\n\r\n          view = createView(this, data, previous.nextSibling)\r\n          this.iterated.push(view)\r\n        } else {\r\n          if (view.models[modelName] !== model) {\r\n            // search for a view that matches the model\r\n            let matchIndex, nextView\r\n            for (let nextIndex = index + 1; nextIndex < this.iterated.length; nextIndex++) {\r\n              nextView = this.iterated[nextIndex]\r\n              if (nextView.models[modelName] === model) {\r\n                matchIndex = nextIndex\r\n                break\r\n              }\r\n            }\r\n            if (matchIndex !== undefined) {\r\n              // model is in other position\r\n              // todo: consider avoiding the splice here by setting a flag\r\n              // profile performance before implementing such change\r\n              this.iterated.splice(matchIndex, 1)\r\n              this.marker.parentNode.insertBefore(nextView.els[0], view.els[0])\r\n              nextView.models[indexProp] = index\r\n            } else {\r\n              //new model\r\n              nextView = createView(this, data, view.els[0])\r\n            }\r\n            this.iterated.splice(index, 0, nextView)\r\n          } else {\r\n            view.models[indexProp] = index\r\n          }\r\n        }\r\n      })\r\n\r\n      if (this.iterated.length > collection.length) {\r\n        times(this.iterated.length - collection.length, () => {\r\n          let view = this.iterated.pop()\r\n          view.unbind()\r\n          this.marker.parentNode.removeChild(view.els[0])\r\n        })\r\n      }\r\n\r\n      if (el.nodeName === 'OPTION') {\r\n        this.view.bindings.forEach(binding => {\r\n          if (binding.el === this.marker.parentNode && binding.type === 'value') {\r\n            binding.sync()\r\n          }\r\n        })\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      let data = {}\r\n\r\n      //todo: add test and fix if necessary\r\n\r\n      Object.keys(models).forEach(key => {\r\n        if (key !== this.arg) {\r\n          data[key] = models[key]\r\n        }\r\n      })\r\n\r\n      this.iterated.forEach(view => {\r\n        view.update(data)\r\n      })\r\n    }\r\n  },\r\n\r\n  // Adds or removes the class from the element when value is true or false.\r\n  'class-*': function(el, value) {\r\n    let elClass = ` ${el.className} `\r\n\r\n    if (!value === (elClass.indexOf(` ${this.arg} `) > -1)) {\r\n      if (value) {\r\n        el.className = `${el.className} ${this.arg}`\r\n      } else {\r\n        el.className = elClass.replace(` ${this.arg} `, ' ').trim()\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's text value.\r\n  text: (el, value) => {\r\n    el.textContent = value != null ? value : ''\r\n  },\r\n\r\n  // Sets the element's HTML content.\r\n  html: (el, value) => {\r\n    el.innerHTML = value != null ? value : ''\r\n  },\r\n\r\n  // Shows the element when value is true.\r\n  show: (el, value) => {\r\n    el.style.display = value ? '' : 'none'\r\n  },\r\n\r\n  // Hides the element when value is true (negated version of `show` binder).\r\n  hide: (el, value) => {\r\n    el.style.display = value ? 'none' : ''\r\n  },\r\n\r\n  // Enables the element when value is true.\r\n  enabled: (el, value) => {\r\n    el.disabled = !value\r\n  },\r\n\r\n  // Disables the element when value is true (negated version of `enabled` binder).\r\n  disabled: (el, value) => {\r\n    el.disabled = !!value\r\n  },\r\n\r\n  // Checks a checkbox or radio input when the value is true. Also sets the model\r\n  // property when the input is checked or unchecked (two-way binder).\r\n  checked: {\r\n    publishes: true,\r\n    priority: 2000,\r\n\r\n    bind: function(el) {\r\n      var self = this;\r\n      if (!this.callback) {\r\n        this.callback = function () {\r\n          self.publish();\r\n        }\r\n      }\r\n      el.addEventListener('change', this.callback)\r\n    },\r\n\r\n    unbind: function(el) {\r\n      el.removeEventListener('change', this.callback)\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (el.type === 'radio') {\r\n        el.checked = getString(el.value) === getString(value)\r\n      } else {\r\n        el.checked = !!value\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's value. Also sets the model property when the input changes\r\n  // (two-way binder).\r\n  value: {\r\n    publishes: true,\r\n    priority: 3000,\r\n\r\n    bind: function(el) {\r\n      this.isRadio = el.tagName === 'INPUT' && el.type === 'radio';\r\n      if (!this.isRadio) {\r\n        this.event = el.getAttribute('event-name') || (el.tagName === 'SELECT' ? 'change' : 'input')\r\n\r\n        var self = this;\r\n        if (!this.callback) {\r\n          this.callback = function () {\r\n            self.publish();\r\n          }\r\n        }\r\n\r\n        el.addEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (!this.isRadio) {\r\n        el.removeEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.isRadio) {\r\n        el.setAttribute('value', value)\r\n      } else {\r\n        if (el.type === 'select-multiple') {\r\n          if (value instanceof Array) {\r\n            for (let i = 0; i < el.length; i++) {\r\n              let option = el[i];\r\n              option.selected = value.indexOf(option.value) > -1\r\n            }\r\n          }\r\n        } else if (getString(value) !== getString(el.value)) {\r\n          el.value = value != null ? value : ''\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // Inserts and binds the element and it's child nodes into the DOM when true.\r\n  if: {\r\n    block: true,\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(' tinybind: ' + this.type + ' ' + this.keypath + ' ');\r\n        this.attached = false\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else if (this.bound === false && this.nested) {\r\n        this.nested.bind()\r\n      }\r\n      this.bound = true\r\n    },\r\n\r\n    unbind: function() {\r\n      if (this.nested) {\r\n        this.nested.unbind()\r\n        this.bound = false\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (!!value !== this.attached) {\r\n        if (value) {\r\n\r\n          if (!this.nested) {\r\n            this.nested = new View(el, this.view.models, this.view.options)\r\n            this.nested.bind()\r\n          }\r\n\r\n          this.marker.parentNode.insertBefore(el, this.marker.nextSibling)\r\n          this.attached = true\r\n        } else {\r\n          el.parentNode.removeChild(el)\r\n          this.attached = false\r\n        }\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      if (this.nested) {\r\n        this.nested.update(models)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default binders\r\n","import tinybind from './tinybind'\r\nimport View from './view'\r\nimport {OPTIONS, EXTENSIONS} from './constants'\r\nimport adapter from './adapter'\r\nimport binders from './binders'\r\nimport Observer from './observer'\r\n\r\n// Returns the public interface.\r\n\r\ntinybind.binders = binders\r\ntinybind.adapters['.'] = adapter\r\n\r\n// Binds some data to a template / element. Returns a tinybind.View instance.\r\ntinybind.bind = (el, models, options) => {\r\n  let viewOptions = {}\r\n  models = models || {}\r\n  options = options || {}\r\n\r\n  EXTENSIONS.forEach(extensionType => {\r\n    viewOptions[extensionType] = Object.create(null)\r\n\r\n    if (options[extensionType]) {\r\n      Object.keys(options[extensionType]).forEach(key => {\r\n        viewOptions[extensionType][key] = options[extensionType][key]\r\n      })\r\n    }\r\n\r\n    Object.keys(tinybind[extensionType]).forEach(key => {\r\n      if (!viewOptions[extensionType][key]) {\r\n        viewOptions[extensionType][key] = tinybind[extensionType][key]\r\n      }\r\n    })\r\n  })\r\n\r\n  OPTIONS.forEach(option => {\r\n    let value = options[option]\r\n    viewOptions[option] = value != null ? value : tinybind[option]\r\n  })\r\n\r\n  viewOptions.starBinders = Object.keys(viewOptions.binders).filter(function (key) {\r\n    return key.indexOf('*') > 0\r\n  })\r\n\r\n  Observer.updateOptions(viewOptions)\r\n\r\n  let view = new View(el, models, viewOptions)\r\n  view.bind()\r\n  return view\r\n}\r\n\r\ntinybind.formatters.negate = tinybind.formatters.not = function (value) {\r\n  return !value;\r\n};\r\n\r\nexport default tinybind\r\n"],"names":["OPTIONS","EXTENSIONS","PRIMITIVE","KEYPATH","TEXT","BINDING","QUOTED_STR","parseType","string","type","value","test","slice","undefined","isNaN","Number","parseTemplate","template","delimiters","tokens","length","index","lastIndex","open","close","indexOf","push","substring","lastToken","trim","tinybind","prefix","_prefix","_fullPrefix","context","ev","binding","call","view","models","el","setAttribute","removeAttribute","options","keys","forEach","option","key","isObject","obj","error","message","Error","adapters","interfaces","rootInterface","Observer","keypath","callback","objectPath","parse","getRootObject","target","realize","set","updateOptions","Object","tokenize","root","current","i","path","chr","charAt","prototype","substr","pop","unreached","prev","token","get","splice","sync","next","oldValue","newValue","Function","Array","setValue","active","action","unobserve","rootProp","$parent","getInputValue","results","checked","selected","FORMATTER_ARGS","FORMATTER_SPLIT","Binding","binder","arg","formatters","formatterObservers","model","observe","parseTarget","observer","parseFormatterArguments","args","formatterIndex","map","ai","formattedValue","reduce","result","declaration","match","id","shift","formatter","processedArgs","read","eventHandler","fn","handler","function","routineFn","routine","publish","reduceRight","split","getValue","bind","hasOwnProperty","preloadData","unbind","fi","update","textBinder","node","data","DECLARATION_SPLIT","parseNode","block","nodeType","templateDelimiters","text","document","createTextNode","parentNode","insertBefore","buildBinding","removeChild","traverse","childNodes","bindingComparator","a","b","aPriority","priority","bPriority","trimStr","str","View","els","jquery","build","pipes","bindings","elements","len","sort","bindingPrefix","nodeName","attributes","bindInfos","starBinders","identifier","attribute","name","binders","k","fallbackBinder","attr","bindInfo","publishes","ARRAY_METHODS","adapter","counter","defineProperty","weakmap","__rv","ref","callbacks","pointers","original","weakReference","response","apply","r","stubFunction","idx","cleanupWeakReference","desc","getOwnPropertyDescriptor","configurable","unobserveMutations","observeMutations","getString","toString","times","n","cb","createView","anchorEl","cloneNode","marker","removeEventListener","addEventListener","createComment","iterated","collection","modelName","indexProp","getAttribute","previous","nextSibling","matchIndex","nextView","nextIndex","elClass","className","replace","textContent","innerHTML","style","display","disabled","self","isRadio","tagName","event","attached","bound","nested","viewOptions","extensionType","create","filter","negate","not"],"mappings":"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"}