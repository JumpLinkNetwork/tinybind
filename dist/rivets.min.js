!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rivets=t():e.rivets=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=n(i(1)),s=n(i(2)),o=n(i(4)),a=n(i(8)),u=n(i(9)),c=function(e){return s.sightglass=e,s.binders=u,s.adapters["."]=a,s.bind=function(e){var t=void 0===arguments[1]?{}:arguments[1],i=void 0===arguments[2]?{}:arguments[2],n=new o(e,t,i);return n.bind(),n},s.init=function(e,t){var i=void 0===arguments[2]?{}:arguments[2];t||(t=document.createElement("div"));var e=s.components[e];t.innerHTML=e.template.call(s,t);var n=e.initialize.call(s,t,i),r=new o(t,n);return r.bind(),r},s};e.exports=c(r)},function(e,t,i){var n,r;(function(){function i(e,t,i,n){return new s(e,t,i,n)}function s(e,t,i,n){this.options=n||{},this.options.adapters=this.options.adapters||{},this.keypath=t,this.callback=i,this.objectPath=[],this.update=this.update.bind(this),this.parse(),this.obj=this.getRootObject(e),o(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function o(e){return"object"==typeof e&&null!==e}function a(e){throw new Error("[sightglass] "+e)}i.adapters={},s.tokenize=function(e,t,i){var n,r,s=[],o={i:i,path:""};for(n=0;n<e.length;n++)r=e.charAt(n),~t.indexOf(r)?(s.push(o),o={i:r,path:""}):o.path+=r;return s.push(o),s},s.prototype.parse=function(){var e,t,n=this.interfaces();n.length||a("Must define at least one adapter interface."),~n.indexOf(this.keypath[0])?(e=this.keypath[0],t=this.keypath.substr(1)):("undefined"==typeof(e=this.options.root||i.root)&&a("Must define a default root adapter."),t=this.keypath),this.tokens=s.tokenize(t,n,e),this.key=this.tokens.pop()},s.prototype.realize=function(){var e,t=this.obj,i=!1;return this.tokens.forEach(function(n,r){o(t)?("undefined"!=typeof this.objectPath[r]?t!==(e=this.objectPath[r])&&(this.set(!1,n,e,this.update),this.set(!0,n,t,this.update),this.objectPath[r]=t):(this.set(!0,n,t,this.update),this.objectPath[r]=t),t=this.get(n,t)):(i===!1&&(i=r),(e=this.objectPath[r])&&this.set(!1,n,e,this.update))},this),i!==!1&&this.objectPath.splice(i),t},s.prototype.update=function(){var e,t,i;(e=this.realize())!==this.target?(o(this.target)&&this.set(!1,this.key,this.target,this.callback),o(e)&&this.set(!0,this.key,e,this.callback),t=this.value(),this.target=e,i=this.value(),(i!==t||i instanceof Function)&&this.callback()):e instanceof Array&&this.callback()},s.prototype.value=function(){if(o(this.target))return this.get(this.key,this.target)},s.prototype.setValue=function(e){o(this.target)&&this.adapter(this.key).set(this.target,this.key.path,e)},s.prototype.get=function(e,t){return this.adapter(e).get(t,e.path)},s.prototype.set=function(e,t,i,n){var r=e?"observe":"unobserve";this.adapter(t)[r](i,t.path,n)},s.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(i.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},s.prototype.adapter=function(e){return this.options.adapters[e.i]||i.adapters[e.i]},s.prototype.unobserve=function(){var e;this.tokens.forEach(function(t,i){(e=this.objectPath[i])&&this.set(!1,t,e,this.update)},this),o(this.target)&&this.set(!1,this.key,this.target,this.callback)},s.prototype.getRootObject=function(e){var t,i;if(!e.$parent)return e;for(t=this.tokens.length?this.tokens[0].path:this.key.path,i=e;i.$parent&&void 0===i[t];)i=i.$parent;return i},"undefined"!=typeof e&&e.exports?e.exports=i:(n=[],r=function(){return this.sightglass=i}.apply(t,n),!(void 0!==r&&(e.exports=r)))}).call(void 0)},function(e,t,i){"use strict";var n=i(3),r=(n.OPTIONS,n.EXTENSIONS),s={binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(e,t,i){this.call(e,t,i.view.models)},configure:function(){var e=this,t=void 0===arguments[0]?{}:arguments[0];Object.keys(t).forEach(function(i){var n=t[i];r.indexOf(i)>-1?Object.keys(n).forEach(function(t){e[i][t]=n[t]}):e[i]=n})}};e.exports=s},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=["prefix","templateDelimiters","rootInterface","preloadData","handler"];t.OPTIONS=i;var n=["binders","formatters","components","adapters"];t.EXTENSIONS=n},function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=function(){function e(e,t){for(var i in t){var n=t[i];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=n(i(2)),a=i(3),u=a.OPTIONS,c=a.EXTENSIONS,h=i(5),f=h.Binding,l=h.TextBinding,d=h.ComponentBinding,p=i(6).parseTemplate,v=function(e){return void 0!==e&&null!==e},b=function(){function e(t,i){var n=this,r=void 0===arguments[2]?{}:arguments[2];s(this,e),t.jquery||t instanceof Array?this.els=t:this.els=[t],this.models=i,c.forEach(function(e){n[e]={},r[e]&&Object.keys(r[e]).forEach(function(t){n[e][t]=r[e][t]}),Object.keys(o[e]).forEach(function(t){v(n[e][t])||(n[e][t]=o[e][t])})}),u.forEach(function(e){n[e]=v(r[e])?r[e]:o[e]}),this.build()}return r(e,{options:{value:function t(){var e=this,t={};return c.concat(u).forEach(function(i){t[i]=e[i]}),t}},bindingRegExp:{value:function(){return new RegExp("^"+this.prefix+"-")}},buildBinding:{value:function(e,t,i,n){var r=n.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g).map(function(e){return e.trim()}),s=r.shift().split("<").map(function(e){return e.trim()}),o=s.shift(),a=s.shift(),u={formatters:r};a&&(u.dependencies=a.split(/\s+/)),this.bindings.push(new e(this,t,i,o,u))}},build:{value:function(){var e=this;this.bindings=[];var t=function(i){var n=!1;if(3===i.nodeType){var r=e.templateDelimiters;if(r){var s=p(i.data,r);s.length&&(1===s.length&&0===s[0].type||(s.forEach(function(t){var n=document.createTextNode(t.value);i.parentNode.insertBefore(n,i),1===t.type&&e.buildBinding(l,n,null,t.value)}),i.parentNode.removeChild(i)))}}else 1===i.nodeType&&(n=e.traverse(i));n||Array.prototype.slice.call(i.childNodes).forEach(t)};this.els.forEach(t),this.bindings.sort(function(e,t){var i=v(e.binder)?e.binder.priority||0:0,n=v(t.binder)?t.binder.priority||0:0;return n-i})}},traverse:{value:function(e){var t=this,i=this.bindingRegExp(),n="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,r=null;if(Array.prototype.slice.call(e.attributes).forEach(function(e){i.test(e.name)&&!function(){var s=e.name.replace(i,""),o=t.binders[s];o||Object.keys(t.binders).forEach(function(e){var i=t.binders[e];if("*"!==e&&e.indexOf("*")>-1){var n=new RegExp("^"+e.replace(/\*/g,".+")+"$");n.test(s)&&(o=i)}}),v(o)||(o=t.binders["*"]),o.block&&(n=!0,r=[e])}()}),r=r||Array.prototype.slice.call(e.attributes),r.forEach(function(n){if(i.test(n.name)){var r=n.name.replace(i,"");t.buildBinding(f,e,r,n.value)}}),!n){var s=e.nodeName.toLowerCase();this.components[s]&&!e._bound&&(this.bindings.push(new d(this,e,s)),n=!0)}return n}},select:{value:function(e){return this.bindings.filter(e)}},bind:{value:function(){this.bindings.forEach(function(e){e.bind()})}},unbind:{value:function(){this.bindings.forEach(function(e){e.unbind()})}},sync:{value:function(){this.bindings.forEach(function(e){e.sync()})}},publish:{value:function(){var e=this.select(function(e){if(v(e.binder))return e.binder.publishes});e.forEach(function(e){e.publish()})}},update:{value:function(){var e=this,t=void 0===arguments[0]?{}:arguments[0];Object.keys(t).forEach(function(i){e.models[i]=t[i]}),this.bindings.forEach(function(e){v(e.update)&&e.update(t)})}}}),e}();e.exports=b},function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(){function e(e,t){for(var i in t){var n=t[i];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(t,"__esModule",{value:!0});var u=n(i(2)),c=i(6).parseType,h=i(7).getInputValue,f=i(3),l=f.EXTENSIONS,d=f.OPTIONS,p=function(e){return void 0!==e&&null!==e},v=t.Binding=function(){function e(t,i,n,r){var s=void 0===arguments[4]?{}:arguments[4];a(this,e),this.view=t,this.el=i,this.type=n,this.keypath=r,this.options=s,this.formatters=s.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder(),this.bind=this.bind.bind(this),this.unbind=this.unbind.bind(this),this.sync=this.sync.bind(this),this.publish=this.publish.bind(this)}return o(e,{setBinder:{value:function(){var e=this;this.binder=this.view.binders[this.type],this.binder||Object.keys(this.view.binders).forEach(function(t){var i=e.view.binders[t];if("*"!==t&&t.indexOf("*")>-1){var n=new RegExp("^"+t.replace(/\*/g,".+")+"$");n.test(e.type)&&(e.binder=i,e.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(e.type),e.args.shift())}}),p(this.binder)||(this.binder=this.view.binders["*"]),this.binder instanceof Function&&(this.binder={routine:this.binder})}},observe:{value:function(e,t,i){return u.sightglass(e,t,i,{root:this.view.rootInterface,adapters:this.view.adapters})}},parseTarget:{value:function(){if(this.keypath){var e=c(this.keypath);0===e.type?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)}else this.value=void 0}},formattedValue:{value:function(e){var t=this;return this.formatters.forEach(function(i,n){var r=i.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),s=r.shift(),o=t.view.formatters[s],a=[];r=r.map(c),r.forEach(function(e,i){if(0===e.type)a.push(e.value);else{p(t.formatterObservers[n])||(t.formatterObservers[n]={});var r=t.formatterObservers[n][i];r||(r=t.observe(t.view.models,e.value,t.sync),t.formatterObservers[n][i]=r),a.push(r.value())}}),o&&o.read instanceof Function?e=o.read.apply(o,[e].concat(a)):o instanceof Function&&(e=o.apply(void 0,[e].concat(a)))}),e}},eventHandler:{value:function(e){var t=this,i=t.view.handler;return function(n){i.call(e,this,n,t)}}},set:{value:function(e){e=e instanceof Function&&!this.binder["function"]?this.formattedValue(e.call(this.model)):this.formattedValue(e),this.binder.routine&&this.binder.routine.call(this,this.el,e)}},sync:{value:function(){var e=this;if(this.observer){if(this.model!==this.observer.target){var t=this.options.dependencies;this.dependencies.forEach(function(e){e.unobserve()}),this.dependencies=[],this.model=this.observer.target,p(this.model)&&t&&t.length&&t.forEach(function(t){var i=e.observe(e.model,t,e.sync);e.dependencies.push(i)})}this.set(this.observer.value())}else this.set(this.value)}},publish:{value:function(){var e=this;this.observer&&!function(){var t=e.getValue(e.el);e.formatters.slice(0).reverse().forEach(function(i){var n=i.split(/\s+/),s=n.shift(),o=e.view.formatters[s];p(o)&&o.publish&&(t=o.publish.apply(o,[t].concat(r(n))))}),e.observer.setValue(t)}()}},bind:{value:function(){var e=this;this.parseTarget(),p(this.binder.bind)&&this.binder.bind.call(this,this.el),p(this.model)&&p(this.options.dependencies)&&this.options.dependencies.forEach(function(t){var i=e.observe(e.model,t,e.sync);e.dependencies.push(i)}),this.view.preloadData&&this.sync()}},unbind:{value:function(){var e=this;p(this.binder.unbind)&&this.binder.unbind.call(this,this.el),p(this.observer)&&this.observer.unobserve(),this.dependencies.forEach(function(e){e.unobserve()}),this.dependencies=[],Object.keys(this.formatterObservers).forEach(function(t){var i=e.formatterObservers[t];Object.keys(i).forEach(function(e){i[e].unobserve()})}),this.formatterObservers={}}},update:{value:function(){var e=void 0===arguments[0]?{}:arguments[0];p(this.observer)&&(this.model=this.observer.target),p(this.binder.update)&&this.binder.update.call(this,e)}},getValue:{value:function(e){return this.binder&&p(this.binder.getValue)?this.binder.getValue.call(this,e):h(e)}}}),e}();t.ComponentBinding=function(e){function t(e,i,n){a(this,t),this.view=e,this.el=i,this.type=n,this.component=this.view.components[this.type],this["static"]={},this.observers={},this.upstreamObservers={};for(var r=e.bindingRegExp(),s=0,o=i.attributes.length;s<o;s++){var u=i.attributes[s];if(!r.test(u.name)){var c=this.camelCase(u.name),h=this.component["static"];h&&h.indexOf(c)>-1?this["static"][c]=u.value:this.observers[c]=u.value}}}return s(t,e),o(t,{sync:{value:function(){}},update:{value:function(){}},publish:{value:function(){}},locals:{value:function(){var e=this,t={};return Object.keys(this["static"]).forEach(function(i){t[i]=e["static"][i]}),Object.keys(this.observers).forEach(function(i){t[i]=e.observers[i].value()}),t}},camelCase:{value:function(e){return e.replace(/-([a-z])/g,function(e){e[1].toUpperCase()})}},bind:{value:function(){var e=this;this.bound||(Object.keys(this.observers).forEach(function(t){var i=e.observers[t];e.observers[t]=e.observe(e.view.models,i,function(t){return function(){e.componentView.models[t]=e.observers[t].value()}}.call(e,t))}),this.bound=!0),p(this.componentView)?this.componentView.bind():!function(){e.el.innerHTML=e.component.template.call(e);var t=e.component.initialize.call(e,e.el,e.locals());e.el._bound=!0;var i={};l.forEach(function(t){i[t]={},e.component[t]&&Object.keys(e.component[t]).forEach(function(n){i[t][n]=e.component[t][n]}),Object.keys(e.view[t]).forEach(function(n){p(i[t][n])||(i[t][n]=e.view[t][n])})}),d.forEach(function(t){p(e.component[t])?i[t]=e.component[t]:i[t]=e.view[t]}),e.componentView=u.bind(Array.prototype.slice.call(e.el.childNodes),t,i),Object.keys(e.observers).forEach(function(t){var i=e.observers[t],n=e.componentView.models,r=e.observe(n,t,function(t,i){return function(){i.setValue(e.componentView.models[t])}}.call(e,t,i));e.upstreamObservers[t]=r})}()}},unbind:{value:function(){var e=this;Object.keys(this.upstreamObservers).forEach(function(t){e.upstreamObservers[t].unobserve()}),Object.keys(this.observers).forEach(function(t){e.observers[t].unobserve()}),p(this.componentView)&&this.componentView.unbind.call(this)}}}),t}(v),t.TextBinding=function(e){function t(e,i,n,r){var s=void 0===arguments[4]?{}:arguments[4];a(this,t),this.view=e,this.el=i,this.type=n,this.keypath=r,this.options=s,this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.binder={routine:function(e,t){e.data=p(t)?t:""}},this.sync=this.sync.bind(this)}return s(t,e),t}(v)},function(e,t){"use strict";function i(e){var t=r,i=e;return/^'.*'$|^".*"$/.test(e)?i=e.slice(1,-1):"true"===e?i=!0:"false"===e?i=!1:"null"===e?i=null:"undefined"===e?i=void 0:isNaN(e)?t=s:i=Number(e),{type:t,value:i}}function n(e,t){for(var i=[],n=e.length,r=0,s=0;s<n;){if(r=e.indexOf(t[0],s),r<0){i.push({type:o,value:e.slice(s)});break}if(r>0&&s<r&&i.push({type:o,value:e.slice(s,r)}),s=r+t[0].length,r=e.indexOf(t[1],s),r<0){var u=e.slice(s-t[1].length),c=i[i.length-1];c&&c.type===o?c.value+=u:i.push({type:o,value:u});break}var h=e.slice(s,r).trim();i.push({type:a,value:h}),s=r+t[1].length}return i}t.parseType=i,t.parseTemplate=n,Object.defineProperty(t,"__esModule",{value:!0});var r=0,s=1,o=0,a=1},function(e,t){"use strict";function i(e,t,i){s?s(e).on(t,i):e.addEventListener(t,i,!1)}function n(e,t,i){s?s(e).off(t,i):e.removeEventListener(t,i,!1)}function r(e){if(s){var t=s(e);return"checkbox"===t.attr("type")?t.is(":checked"):t.val()}if("checkbox"===e.type)return e.checked;if("select-multiple"!==e.type)return e.value;var i=function(){var t=[];return e.options.forEach(function(e){e.selected&&t.push(e.value)}),{v:t}}();return"object"==typeof i?i.v:void 0}t.bindEvent=i,t.unbindEvent=n,t.getInputValue=r,Object.defineProperty(t,"__esModule",{value:!0});var s=window.jQuery||window.$},function(e,t){"use strict";var i=["push","pop","shift","unshift","sort","reverse","splice"],n={id:"_rv",counter:0,weakmap:{},weakReference:function(e){if(!e.hasOwnProperty(this.id)){var t=this.counter++;Object.defineProperty(e,this.id,{value:t})}return this.weakmap[e[this.id]]||(this.weakmap[e[this.id]]={callbacks:{}}),this.weakmap[e[this.id]]},cleanupWeakReference:function(e,t){Object.keys(e.callbacks).length||e.pointers&&Object.keys(e.pointers).length||delete this.weakmap[t]},stubFunction:function(e,t){var i=e[t],n=this.weakReference(e),r=this.weakmap;e[t]=function(){for(var t=arguments.length,s=Array(t),o=0;o<t;o++)s[o]=arguments[o];var a=i.apply(e,s);return Object.keys(n.pointers).forEach(function(e){var t=n.pointers[e];r[e]&&r[e].callbacks[t]instanceof Array&&r[e].callbacks[t].forEach(function(e){e()})}),a}},observeMutations:function(e,t,n){var r=this;if(e instanceof Array){var s=this.weakReference(e);s.pointers||(s.pointers={},i.forEach(function(t){r.stubFunction(e,t)})),s.pointers[t]||(s.pointers[t]=[]),s.pointers[t].indexOf(n)===-1&&s.pointers[t].push(n)}},unobserveMutations:function(e,t,i){if(e instanceof Array&&null!=e[this.id]){var n=this.weakmap[e[this.id]];if(n){var r=n.pointers[t];if(r){var s=r.indexOf(i);s>-1&&r.splice(s,1),r.length||delete n.pointers[t],this.cleanupWeakReference(n,e[this.id])}}}},observe:function(e,t,i){var n=this,r=this.weakReference(e).callbacks;if(!r[t]){r[t]=[];var s=Object.getOwnPropertyDescriptor(e,t);s&&(s.get||s.set||!s.configurable)||!function(){var i=e[t];Object.defineProperty(e,t,{enumerable:!0,get:function(){return i},set:function(r){if(r!==i){n.unobserveMutations(i,e[n.id],t),i=r;var s=n.weakmap[e[n.id]];if(s){var o=s.callbacks[t];o&&o.forEach(function(e){e()}),n.observeMutations(r,e[n.id],t)}}}})}()}r[t].indexOf(i)===-1&&r[t].push(i),this.observeMutations(e[t],e[this.id],t)},unobserve:function(e,t,i){var n=this.weakmap[e[this.id]];if(n){var r=n.callbacks[t];if(r){var s=r.indexOf(i);s>-1&&(r.splice(s,1),r.length||(delete n.callbacks[t],this.unobserveMutations(e[t],e[this.id],t))),this.cleanupWeakReference(n,e[this.id])}}},get:function(e,t){return e[t]},set:function(e,t,i){e[t]=i}};e.exports=n},function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=n(i(2)),s=i(7),o=s.bindEvent,a=s.unbindEvent,u="change",c=function(e){return void 0!==e&&null!==e},h=function(e){return c(e)?e.toString():void 0},f=function(e,t){for(var i=0;i<e;i++)t()},l={text:function(e,t){e.textContent=c(t)?t:""},html:function(e,t){e.innerHTML=c(t)?t:""},show:function(e,t){e.style.display=t?"":"none"},hide:function(e,t){e.style.display=t?"none":""},enabled:function(e,t){e.disabled=!t},disabled:function(e,t){e.disabled=!!t},checked:{publishes:!0,priority:2e3,bind:function(e){o(e,u,this.publish)},unbind:function(e){a(e,u,this.publish)},routine:function(e,t){"radio"===e.type?e.checked=h(e.value)===h(t):e.checked=!!t}},unchecked:{publishes:!0,priority:2e3,bind:function(e){o(e,u,this.publish)},unbind:function(e){a(e,u,this.publish)},routine:function(e,t){"radio"===e.type?e.checked=h(e.value)!==h(t):e.checked=!t}},value:{publishes:!0,priority:3e3,bind:function(e){"INPUT"===e.tagName&&"radio"===e.type||(this.event="SELECT"===e.tagName?"change":"input",o(e,this.event,this.publish))},unbind:function(e){"INPUT"===e.tagName&&"radio"===e.type||a(e,this.event,this.publish)},routine:function(e,t){if("INPUT"===e.tagName&&"radio"===e.type)e.setAttribute("value",t);else if(window.jQuery)e=jQuery(e),h(t)!==h(e.val())&&e.val(c(t)?t:"");else if("select-multiple"===e.type){if(t instanceof Array)for(var i=0;i<e.length;i++){var n=e[i];n.selected=t.indexOf(n.value)>-1}}else h(t)!==h(e.value)&&(e.value=c(t)?t:"")}},"if":{block:!0,priority:4e3,bind:function(e){if(!this.marker){var t=[this.view.prefix,this.type].join("-").replace("--","-"),i=e.getAttribute(t);this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,e.removeAttribute(t),e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}},unbind:function(){this.nested&&(this.nested.unbind(),this.bound=!1)},routine:function(e,t){!!t==!this.bound&&(t?(this.nested?this.nested.bind():this.nested=r.bind(e,this.view.models,this.view.options()),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0):(e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1))},update:function(e){this.nested&&this.nested.update(e)}},unless:{block:!0,priority:4e3,bind:function(e){r.binders["if"].bind.call(this,e)},unbind:function(){r.binders["if"].unbind.call(this)},routine:function(e,t){r.binders["if"].routine.call(this,e,!t)},update:function(e){r.binders["if"].update.call(this,e)}},"on-*":{"function":!0,priority:1e3,unbind:function(e){this.handler&&a(e,this.args[0],this.handler)},routine:function(e,t){this.handler&&a(e,this.args[0],this.handler),this.handler=this.eventHandler(t),o(e,this.args[0],this.handler)}},"each-*":{block:!0,priority:4e3,bind:function(e){if(this.marker)this.iterated.forEach(function(e){e.bind()});else{var t=[this.view.prefix,this.type].join("-").replace("--","-");this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],e.removeAttribute(t),e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}},unbind:function(e){this.iterated&&this.iterated.forEach(function(e){e.unbind()})},routine:function(e,t){var i=this,n=this.args[0],t=t||[],s=e.getAttribute("index-property")||"$index";this.iterated.length>t.length&&f(this.iterated.length-t.length,function(){var e=i.iterated.pop();e.unbind(),i.marker.parentNode.removeChild(e.els[0])}),t.forEach(function(t,o){var a={$parent:i.view.models};if(a[s]=o,a[n]=t,i.iterated[o])i.iterated[o].models[n]!==t&&i.iterated[o].update(a);else{var u=i.marker;i.iterated.length&&(u=i.iterated[i.iterated.length-1].els[0]);var c=i.view.options();c.preloadData=!0;var h=e.cloneNode(!0),f=r.bind(h,a,c);i.iterated.push(f),i.marker.parentNode.insertBefore(h,u.nextSibling)}}),"OPTION"===e.nodeName&&this.view.bindings.forEach(function(e){e.el===i.marker.parentNode&&"value"===e.type&&e.sync()})},update:function(e){var t=this,i={};Object.keys(e).forEach(function(n){n!==t.args[0]&&(i[n]=e[n])}),this.iterated.forEach(function(e){e.update(i)})}},"class-*":function(e,t){var i=" "+e.className+" ";!t==i.indexOf(" "+this.args[0]+" ")>-1&&(t?e.className=""+e.className+" "+this.args[0]:e.className=i.replace(" "+this.args[0]+" "," ").trim())},"*":function(e,t){c(t)?e.setAttribute(this.type,t):e.removeAttribute(this.type)}};e.exports=l}])});