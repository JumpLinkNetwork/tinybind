!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tinybind=t():e.tinybind=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.times=t.getString=t.isObject=t.isJson=t.mergeObject=void 0;t.mergeObject=function(e,t){return t&&Object.keys(t).forEach(function(r){e[r]&&e[r]!=={}||(e[r]=t[r])}),e};t.isJson=function(e){try{var t=JSON.parse(e);return t instanceof Array||t instanceof Object}catch(e){return!1}};t.isObject=function(e){return"object"===n(e)&&null!==e};t.getString=function(e){return null!=e?e.toString():void 0};t.times=function(e,t){for(var r=0;r<e;r++)t()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseType=function(e){var t=i,r=e;u.test(e)?r=e.slice(1,-1):"true"===e?r=!0:"false"===e?r=!1:"null"===e?r=null:"undefined"===e?r=void 0:isNaN(Number(e))?(0,n.isJson)(e)?r=JSON.parse(e):t=a:r=Number(e);return{type:t,value:r}},t.parseTemplate=function(e,t){var r=null,n=e.length,i=0,a=0,u=t[0],c=t[1];for(;a<n;){if((i=e.indexOf(u,a))<0){r&&r.push({type:o,value:e.slice(a)});break}if(r=r||[],i>0&&a<i&&r.push({type:o,value:e.slice(a,i)}),a=i+u.length,(i=e.indexOf(c,a))<0){var l=e.slice(a-c.length),h=r[r.length-1];h&&h.type===o?h.value+=l:r.push({type:o,value:l});break}var f=e.slice(a,i).trim();r.push({type:s,value:f}),a=i+c.length}return r},t.BINDING=t.TEXT=t.KEYPATH=t.PRIMITIVE=void 0;var n=r(0),i=0;t.PRIMITIVE=i;var a=1;t.KEYPATH=a;var o=0;t.TEXT=o;var s=1;t.BINDING=s;var u=/^'.*'$|^".*"$/},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var n=r(3),i=r(5),a=r(6),o=r(1);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c={routine:function(e,t){e.data=null!=t?t:""}},l=/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g,h=function e(t,r){var i=!1;if(3===(r=r).nodeType){if(!r.data)throw new Error("node has no data");var a=(0,o.parseTemplate)(r.data,n.tinybind.templateDelimiters);if(a){if(!r.parentNode)throw new Error("Node has no parent node");for(var s=0;s<a.length;s++){var u=a[s],l=document.createTextNode(u.value);r.parentNode.insertBefore(l,r),1===u.type&&t.buildBinding(l,null,u.value,c,null)}r.parentNode.removeChild(r)}i=!0}else 1===r.nodeType&&(i=t.traverse(r));if(!i&&r.childNodes)for(var h=0;h<r.childNodes.length;h++)e(t,r.childNodes[h])},f=function(e,t){var r=e.binder&&e.binder.priority||0;return(t.binder&&t.binder.priority||0)-r},d=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"els",void 0),u(this,"models",void 0),u(this,"options",void 0),u(this,"bindings",[]),u(this,"componentView",null),t instanceof Array?this.els=t:this.els=[t],this.models=r,this.options=n,this.build()}return function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(e,[{key:"buildBinding",value:function(t,r,n,a,o){var s=e.parseDeclaration(n),u=s.keypath,c=s.pipes;this.bindings.push(new i.Binding(this,t,r,u,a,o,c))}},{key:"build",value:function(){this.bindings=[];var e,t,r=this.els;for(e=0,t=r.length;e<t;e++)h(this,r[e]);this.bindings.sort(f)}},{key:"traverse",value:function(e){for(var t,r,i,o,s=n.tinybind._fullPrefix,u="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,c=e.attributes,l=[],h=this.options.starBinders,f=0,d=c.length;f<d;f++){var p=c[f];if(0===p.name.indexOf(s)){if(t=p.name.slice(s.length),o=[],!(r=this.options.binders[t]))for(var b=0;b<h.length;b++)if(i=h[b],t.slice(0,i.length-1)===i.slice(0,-1)){r=this.options.binders[i],o.push(t.slice(i.length-1));break}if(r||(r=n.tinybind.fallbackBinder),r.block)return this.buildBinding(e,t,p.value,r,o),e.removeAttribute(p.name),!0;l.push({attr:p,binder:r,type:t,args:o})}}for(var v=0;v<l.length;v++){var m=l[v];this.buildBinding(e,m.type,m.attr.value,m.binder,m.args),e.removeAttribute(m.attr.name)}return u||(t=e.nodeName.toLowerCase(),this.options.components[t]&&!e._bound&&(this.bindings.push(new a.ComponentBinding(this,e,t)),u=!0)),u}},{key:"bind",value:function(){this.bindings.forEach(function(e){e.bind()})}},{key:"unbind",value:function(){Array.isArray(this.bindings)&&this.bindings.forEach(function(e){e.unbind()}),this.componentView&&this.componentView.unbind()}},{key:"sync",value:function(){this.bindings.forEach(function(e){e.sync()})}},{key:"publish",value:function(){this.bindings.forEach(function(e){e.binder&&e.binder.publishes&&e.publish()})}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach(function(r){e.models[r]=t[r]}),this.bindings.forEach(function(e){e.update&&e.update(t)})}}],[{key:"parseDeclaration",value:function(e){var t=e.match(l);if(null===t)throw new Error("no matches");var r=t.map(function(e){return e.trim()});return{keypath:r.shift()||null,pipes:r}}}]),e}();t.View=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.tinybind=void 0;var n=r(0),i=r(1),a=r(9),o=r(8),s=r(7),u=r(2),c=r(4),l={binders:s.binders,components:{},formatters:a.formatters,adapters:{".":o.adapter},_prefix:"rv",_fullPrefix:"rv-",get prefix(){return this._prefix},set prefix(e){this._prefix=e,this._fullPrefix=e+"-"},parseTemplate:i.parseTemplate,parseType:i.parseType,templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(e,t,r){this.call(e,t,r.view.models)},fallbackBinder:function(e,t){if(!this.type)throw new Error("Can't set atttribute of "+this.type);null!=t?e.setAttribute(this.type,t):e.removeAttribute(this.type)},configure:function(e){var t=this;e&&Object.keys(e).forEach(function(r){var i=e[r];switch(r){case"binders":(0,n.mergeObject)(t.binders,i);break;case"formatters":(0,n.mergeObject)(t.formatters,i);break;case"components":(0,n.mergeObject)(t.components,i);break;case"adapters":case"adapter":(0,n.mergeObject)(t.adapters,i);break;case"prefix":t.prefix=i;break;case"parseTemplate":t.parseTemplate=i;break;case"parseType":t.parseType=i;break;case"prefix":t.prefix=i;break;case"templateDelimiters":t.templateDelimiters=i;break;case"rootInterface":t.rootInterface=i;break;case"preloadData":t.preloadData=i;break;default:console.warn("Option not supported",r,i)}})},init:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t||(t=document.createElement("div"));var n=l.components[e];t.innerHTML=n.template.call(l,t);var i=n.initialize.call(l,t,r),a=l.bind(t,i);return a.bind(),a},bind:function(e,t,r){var i={binders:Object.create(null),formatters:Object.create(null),components:Object.create(null),adapters:Object.create(null),starBinders:Object.create(null),rootInterface:Object.create(null)};t=t||Object.create(null),r&&((0,n.mergeObject)(i.binders,r.binders),(0,n.mergeObject)(i.formatters,r.formatters),(0,n.mergeObject)(i.components,r.components),(0,n.mergeObject)(i.adapters,r.adapters)),i.prefix=r&&r.prefix?r.prefix:l.prefix,i.templateDelimiters=r&&r.templateDelimiters?r.templateDelimiters:l.templateDelimiters,i.rootInterface=r&&r.rootInterface?r.rootInterface:l.rootInterface,i.preloadData=r&&r.preloadData?r.preloadData:l.preloadData,i.handler=r&&r.handler?r.handler:l.handler,(0,n.mergeObject)(i.binders,l.binders),(0,n.mergeObject)(i.formatters,l.formatters),(0,n.mergeObject)(i.components,l.components),(0,n.mergeObject)(i.adapters,l.adapters),i.starBinders=Object.keys(i.binders).filter(function(e){return e.indexOf("*")>0}),c.Observer.updateOptions(i);var a=new u.View(e,t,i);return a.bind(),a}};t.tinybind=l;var h=l;t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;var n,i,a,o=r(0);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"keypath",void 0),u(this,"callback",void 0),u(this,"objectPath",void 0),u(this,"obj",void 0),u(this,"target",void 0),u(this,"key",void 0),u(this,"tokens",void 0),this.keypath=r,this.callback=n,this.objectPath=[];var i=this.parse();this.key=i.key,this.tokens=i.tokens,this.obj=this.getRootObject(t),this.target=this.realize(),(0,o.isObject)(this.target)&&this.set(!0,this.key,this.target,this.callback)}return function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(e,[{key:"parse",value:function(){var t,r;if(i.length||function(e){throw new Error("[Observer] "+e)}("Must define at least one adapter interface."),~i.indexOf(this.keypath[0])?(r=this.keypath[0],t=this.keypath.substr(1)):(r=a,t=this.keypath),this.tokens=e.tokenize(t,r),!this.tokens.length)throw new Error("no tokens");return this.key=this.tokens.pop(),{key:this.key,tokens:this.tokens}}},{key:"realize",value:function(){for(var e,t,r=this.obj,n=-1,i=0;i<this.tokens.length;i++)t=this.tokens[i],(0,o.isObject)(r)?(void 0!==this.objectPath[i]?r!==(e=this.objectPath[i])&&(this.set(!1,t,e,this),this.set(!0,t,r,this),this.objectPath[i]=r):(this.set(!0,t,r,this),this.objectPath[i]=r),r=this.get(t,r)):(-1===n&&(n=i),(e=this.objectPath[i])&&this.set(!1,t,e,this));return-1!==n&&this.objectPath.splice(n),r}},{key:"sync",value:function(){var e,t,r;(e=this.realize())!==this.target?((0,o.isObject)(this.target)&&this.set(!1,this.key,this.target,this.callback),(0,o.isObject)(e)&&this.set(!0,this.key,e,this.callback),t=this.value(),this.target=e,((r=this.value())!==t||r instanceof Function)&&this.callback.sync()):e instanceof Array&&this.callback.sync()}},{key:"value",value:function(){if((0,o.isObject)(this.target))return this.get(this.key,this.target)}},{key:"setValue",value:function(e){(0,o.isObject)(this.target)&&n[this.key.i].set(this.target,this.key.path,e)}},{key:"get",value:function(e,t){return n[e.i].get(t,e.path)}},{key:"set",value:function(e,t,r,i){e?n[t.i].observe(r,t.path,i):n[t.i].unobserve(r,t.path,i)}},{key:"unobserve",value:function(){for(var e,t,r=0;r<this.tokens.length;r++)t=this.tokens[r],(e=this.objectPath[r])&&this.set(!1,t,e,this);(0,o.isObject)(this.target)&&this.set(!1,this.key,this.target,this.callback)}},{key:"getRootObject",value:function(e){var t,r;if(!e.$parent)return e;for(t=this.tokens.length?this.tokens[0].path:this.key.path,r=e;r.$parent&&void 0===r[t];)r=r.$parent;return r}}]),e}();t.Observer=c,u(c,"updateOptions",function(e){n=e.adapters,i=Object.keys(n),a=e.rootInterface}),u(c,"tokenize",function(e,t){var r,n,a=[],o={i:t,path:""};for(r=0;r<e.length;r++)n=e.charAt(r),~i.indexOf(n)?(a.push(o),o={i:n,path:""}):o.path+=n;return a.push(o),a})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=t.FORMATTER_SPLIT=t.FORMATTER_ARGS=void 0;var n=r(1),i=r(4);function a(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g;t.FORMATTER_ARGS=u;var c=/\s+/;t.FORMATTER_SPLIT=c;var l=function(){function e(t,r,n,i,a,o,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"value",void 0),s(this,"observer",void 0),s(this,"view",void 0),s(this,"el",void 0),s(this,"type",void 0),s(this,"binder",void 0),s(this,"formatters",void 0),s(this,"formatterObservers",void 0),s(this,"keypath",void 0),s(this,"args",void 0),s(this,"model",void 0),s(this,"marker",void 0),s(this,"_bound",void 0),s(this,"customData",void 0),this.view=t,this.el=r,this.type=n,this.keypath=i,this.binder=a,this.args=o,this.formatters=u,this.formatterObservers={},this.model=void 0,this.customData={}}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"observe",value:function(e,t,r){return r?new i.Observer(e,t,r):new i.Observer(e,t,this)}},{key:"parseTarget",value:function(){if(this.keypath){var e=(0,n.parseType)(this.keypath);if(e.type===n.PRIMITIVE)this.value=e.value;else{if(e.type!==n.KEYPATH)throw new Error("Unknown type in token");this.observer=this.observe(this.view.models,this.keypath),this.model=this.observer.target}}else this.value=void 0}},{key:"getIterationAlias",value:function(e){return"%"+e+"%"}},{key:"parseFormatterArguments",value:function(e,t){var r=this;return e.map(n.parseType).map(function(e,i){var a=e.type,o=e.value;if(a===n.PRIMITIVE)return o;if(a===n.KEYPATH){var s=o;r.formatterObservers[t]||(r.formatterObservers[t]={});var u=r.formatterObservers[t][i];return u||(u=r.observe(r.view.models,s),r.formatterObservers[t][i]=u),u.value()}throw new Error("Unknown argument type")})}},{key:"formattedValue",value:function(e){var t=this;if(null===this.formatters)throw new Error("formatters is null");return this.formatters.reduce(function(e,r,n){var i=r.match(u);if(null===i)throw new Error("No args matched from FORMATTER_ARGS");var o=i.shift();if(!o)throw new Error("No id found in args");var s=t.view.options.formatters[o],c=t.parseFormatterArguments(i,n);return s&&s.read instanceof Function?e=s.read.apply(s,[e].concat(a(c))):s instanceof Function&&(e=s.apply(void 0,[e].concat(a(c)))),e},e)}},{key:"eventHandler",value:function(e){var t=this,r=this,n=r.view.options.handler;return function(i){if(!n)throw new Error("No handler defined in binding.view.options.handler");n.call(e,t,i,r)}}},{key:"set",value:function(e){var t;if(e instanceof Function&&!this.binder.function?(e=e,e=this.formattedValue(e.call(this.model))):(e=e,e=this.formattedValue(e)),null===this.binder)throw new Error("binder is null");this.binder.hasOwnProperty("routine")?(this.binder=this.binder,t=this.binder.routine):(this.binder=this.binder,t=this.binder),t instanceof Function&&t.call(this,this.el,e)}},{key:"sync",value:function(){this.observer?(this.model=this.observer.target,this.set(this.observer.value())):this.set(this.value)}},{key:"publish",value:function(){var e=this;if(this.observer){if(null===this.formatters)throw new Error("formatters is null");var t=this.formatters.reduceRight(function(t,r,n){var i=r.split(c),o=i.shift();if(!o)throw new Error("id not defined");var s=e.view.options.formatters[o],u=e.parseFormatterArguments(i,n);return s&&s.publish&&(t=s.publish.apply(s,[t].concat(a(u)))),t},this.getValue(this.el));this.observer.setValue(t)}}},{key:"bind",value:function(){if(this.parseTarget(),this.binder&&this.binder.hasOwnProperty("bind")){if(this.binder=this.binder,!this.binder.bind&&"function"!=typeof this.binder.bind)throw new Error("the method bind is not a function");this.binder.bind.call(this,this.el)}this.view.options.preloadData&&this.sync()}},{key:"unbind",value:function(){var e=this;if(null===this.binder)throw new Error("binder is null");this.binder.hasOwnProperty("bind")&&(this.binder=this.binder,this.binder.unbind&&this.binder.unbind.call(this,this.el)),this.observer&&this.observer.unobserve(),Object.keys(this.formatterObservers).forEach(function(t){var r=e.formatterObservers[t];Object.keys(r).forEach(function(e){r[e].unobserve()})}),this.formatterObservers={}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.observer&&(this.model=this.observer.target),null===this.binder)throw new Error("binder is null");this.binder.hasOwnProperty("update")&&(this.binder=this.binder,this.binder.update&&this.binder.update.call(this,e))}},{key:"getValue",value:function(e){if(null===this.binder)throw new Error("binder is null");if(this.binder.hasOwnProperty("getValue")){if(this.binder=this.binder,"function"!=typeof this.binder.getValue)throw new Error("getValue is not a function");return this.binder.getValue.call(this,e)}return function(e){var t=[];if("checkbox"===e.type)return e.checked;if("select-multiple"===e.type){var r=e.options;for(var n in r)if(r.hasOwnProperty(n)){var i=r[n];i.selected&&t.push(i.value)}return t}return e.value}(e)}}]),e}();t.Binding=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentBinding=void 0;var n=r(3),i=r(1),a=r(5),o=r(2),s=r(0);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var b=function(e){function t(e,r,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(d(d(a=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,h(t).call(this,e,r,i,null,null,null,null)))),"view",void 0),p(d(d(a)),"componentView",void 0),p(d(d(a)),"el",void 0),p(d(d(a)),"type",void 0),p(d(d(a)),"component",void 0),p(d(d(a)),"static",{}),p(d(d(a)),"keypaths",{}),p(d(d(a)),"observers",void 0),p(d(d(a)),"bindingPrefix",n.tinybind._fullPrefix),p(d(d(a)),"pipes",{}),a.view=e,a.el=r,a.type=i,a.component=e.options.components[a.type],a.static={},a.observers={},a.parseTarget(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,a.Binding),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"sync",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){e.componentView&&(e.componentView.models[t]=e.observers[t].target)})}},{key:"update",value:function(){}},{key:"publish",value:function(){}},{key:"locals",value:function(){var e=this,t={};return Object.keys(this.static).forEach(function(r){t[r]=e.formattedValues(e.static[r],r)}),Object.keys(this.observers).forEach(function(r){t[r]=e.formattedValues(e.observers[r].value(),r)}),t}},{key:"camelCase",value:function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})}},{key:"getMergedOptions",value:function(){var e={binders:Object.create(null),formatters:Object.create(null),components:Object.create(null),adapters:Object.create(null)};return(0,s.mergeObject)(e.binders,this.component.binders),(0,s.mergeObject)(e.formatters,this.component.formatters),(0,s.mergeObject)(e.components,this.component.components),(0,s.mergeObject)(e.adapters,this.component.adapters),(0,s.mergeObject)(e.binders,this.view.options.binders),(0,s.mergeObject)(e.formatters,this.view.options.formatters),(0,s.mergeObject)(e.components,this.view.options.components),(0,s.mergeObject)(e.adapters,this.view.options.adapters),e.prefix=this.component.prefix?this.component.prefix:this.view.options.prefix,e.templateDelimiters=this.component.templateDelimiters?this.component.templateDelimiters:this.view.options.templateDelimiters,e.rootInterface=this.component.rootInterface?this.component.rootInterface:this.view.options.rootInterface,e.preloadData=this.component.preloadData?this.component.preloadData:this.view.options.preloadData,e.handler=this.component.handler?this.component.handler:this.view.options.handler,e}},{key:"bind",value:function(){if(this.componentView)this.componentView.bind();else{this.el.innerHTML=this.component.template.call(this);var e=this.component.initialize.call(this,this.el,this.locals());this.componentView=n.tinybind.bind(Array.prototype.slice.call(this.el.childNodes),e,this.getMergedOptions()),this.el._bound=!0}}},{key:"parseTarget",value:function(){for(var e=0,t=this.el.attributes.length;e<t;e++){var r=this.el.attributes[e];if(0!==r.name.indexOf(this.bindingPrefix)){var n=this.camelCase(r.name),a=r.value,s=o.View.parseDeclaration(a);if(this.pipes[n]=s.pipes,null===s.keypath)throw new Error("parsedDeclaration.keypath is null");var u=(0,i.parseType)(s.keypath);if(u.type===i.PRIMITIVE)this.static[n]=u.value;else{if(u.type!==i.KEYPATH)throw new Error("can't parse component attribute");this.keypaths[n]=r.value,this.observers[n]=this.observe(this.view.models,this.keypaths[n],this)}}}}},{key:"parseFormatterArguments",value:function(e,t){var r=this;return e.map(i.parseType).map(function(e,n){var a=e.type,o=e.value;if(a===i.PRIMITIVE)return o;if(a===i.KEYPATH){var s=o;r.formatterObservers[t]||(r.formatterObservers[t]={});var u=r.formatterObservers[t][n];return u||(u=r.observe(r.view.models,s),r.formatterObservers[t][n]=u),u.value()}throw new Error("Unknown argument type")})}},{key:"formattedValues",value:function(e,t){var r=this;if(null===this.pipes[t])throw new Error("formatters is null");return this.pipes[t].reduce(function(e,t,n){var i=t.match(a.FORMATTER_ARGS);if(null===i)throw new Error("No args matched from FORMATTER_ARGS");var o=i.shift();if(!o)throw new Error("No id found in args");var s=r.view.options.formatters[o],u=r.parseFormatterArguments(i,n);return s&&s.read instanceof Function?e=s.read.apply(s,[e].concat(c(u))):s instanceof Function&&(e=s.apply(void 0,[e].concat(c(u)))),e},e)}},{key:"unbind",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){e.observers[t].unobserve()}),this.componentView&&this.componentView.unbind.call(this)}}]),t}();t.ComponentBinding=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.binders=void 0;var n=r(2),i=r(0),a=function(e,t,r){var i=e.el.cloneNode(!0),a=new n.View(i,t,e.view.options);if(a.bind(),!e||!e.marker||null===e.marker.parentNode)throw new Error("No parent node for binding!");return e.marker.parentNode.insertBefore(i,r),a},o={"on-*":{function:!0,priority:1e3,bind:function(e){this.customData||(this.customData={handler:null})},unbind:function(e){if(this.customData.handler){if(null===this.args)throw new Error("args is null");e.removeEventListener(this.args[0],this.customData)}},routine:function(e,t){if(this.customData.handler){if(null===this.args)throw new Error("args is null");e.removeEventListener(this.args[0],this.customData.handler)}if(this.customData.handler=this.eventHandler(t),null===this.args)throw new Error("args is null");e.addEventListener(this.args[0],this.customData.handler)}},"each-*":{block:!0,priority:4e3,bind:function(e){if(this.marker)this.customData.iterated.forEach(function(e){e.bind()});else{if(this.marker=document.createComment(" tinybind: ".concat(this.type," ")),this.customData={iterated:[]},!e.parentNode)throw new Error("No parent node!");e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}},unbind:function(e){this.customData.iterated&&this.customData.iterated.forEach(function(e){e.unbind()})},routine:function(e,t){var r=this;if(null===this.args)throw new Error("args is null");var n=this.args[0];if(t=t||[],!Array.isArray(t))throw new Error("each-"+n+" needs an array to iterate over, but it is");var o=e.getAttribute("index-property")||this.getIterationAlias(n);t.forEach(function(e,t){var i={$parent:r.view.models};i[o]=t,i[n]=e;var s=r.customData.iterated[t];if(s)if(s.models[n]!==e){for(var u,c,l=t+1;l<r.customData.iterated.length;l++)if((c=r.customData.iterated[l]).models[n]===e){u=l;break}if(void 0!==u){if(r.customData.iterated.splice(u,1),!r.marker||!r.marker.parentNode)throw new Error("Marker has no parent node");r.marker.parentNode.insertBefore(c.els[0],s.els[0]),c.models[o]=t}else c=a(r,i,s.els[0]);r.customData.iterated.splice(t,0,c)}else s.models[o]=t;else{var h;if(r.customData.iterated.length)h=r.customData.iterated[r.customData.iterated.length-1].els[0];else{if(!r.marker)throw new Error("previous not defined");h=r.marker}s=a(r,i,h.nextSibling),r.customData.iterated.push(s)}}),this.customData.iterated.length>t.length&&(0,i.times)(this.customData.iterated.length-t.length,function(){var e=r.customData.iterated.pop();if(e.unbind(),!r.marker||!r.marker.parentNode)throw new Error("Marker has no parent node");r.marker.parentNode.removeChild(e.els[0])}),"OPTION"===e.nodeName&&this.view.bindings&&this.view.bindings.forEach(function(e){r.marker&&e.el===r.marker.parentNode&&"value"===e.type&&e.sync()})},update:function(e){var t=this,r={};Object.keys(e).forEach(function(n){if(null===t.args)throw new Error("args is null");n!==t.args[0]&&(r[n]=e[n])}),this.customData.iterated.forEach(function(e){e.update(r)})}},"class-*":function(e,t){var r=" ".concat(e.className," ");if(null===this.args)throw new Error("args is null");t!==r.indexOf(" ".concat(this.args[0]," "))>-1&&(e.className=t?"".concat(e.className," ").concat(this.args[0]):r.replace(" ".concat(this.args[0]," ")," ").trim())},text:function(e,t){e.textContent=null!=t?t:""},html:function(e,t){e.innerHTML=null!=t?t:""},show:function(e,t){e.style.display=t?"":"none"},hide:function(e,t){e.style.display=t?"none":""},enabled:function(e,t){e.disabled=!t},disabled:function(e,t){e.disabled=!!t},checked:{publishes:!0,priority:2e3,bind:function(e){var t=this;this.customData={},this.customData.callback||(this.customData.callback=function(){t.publish()}),e.addEventListener("change",this.customData.callback)},unbind:function(e){e.removeEventListener("change",this.customData.callback)},routine:function(e,t){"radio"===e.type?e.checked=(0,i.getString)(e.value)===(0,i.getString)(t):e.checked=!!t}},value:{publishes:!0,priority:3e3,bind:function(e){if(this.customData={},this.customData.isRadio="INPUT"===e.tagName&&"radio"===e.type,!this.customData.isRadio){this.customData.event=e.getAttribute("event-name")||("SELECT"===e.tagName?"change":"input");var t=this;this.customData.callback||(this.customData.callback=function(){t.publish()}),e.addEventListener(this.customData.event,this.customData.callback)}},unbind:function(e){this.customData.isRadio||e.removeEventListener(this.customData.event,this.customData.callback)},routine:function(e,t){if(this.customData&&this.customData.isRadio)e.setAttribute("value",t);else if("select-multiple"===e.type&&e instanceof HTMLSelectElement){if(t instanceof Array)for(var r=0;r<e.length;r++){var n=e[r];n.selected=t.indexOf(n.value)>-1}}else(0,i.getString)(t)!==(0,i.getString)(e.value)&&(e.value=null!=t?t:"")}},if:{block:!0,priority:4e3,bind:function(e){if(this.customData={},this.marker)!1===this.customData.bound&&this.customData.nested&&this.customData.nested.bind();else{if(this.marker=document.createComment(" tinybind: "+this.type+" "+this.keypath+" "),this.customData.attached=!1,!e.parentNode)throw new Error("Element has no parent node");e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}this.customData.bound=!0},unbind:function(){this.customData.nested&&(this.customData.nested.unbind(),this.customData.bound=!1)},routine:function(e,t){if((t=!!t)!==this.customData.attached)if(t){if(this.customData.nested||(this.customData.nested=new n.View(e,this.view.models,this.view.options),this.customData.nested.bind()),!this.marker||!this.marker.parentNode)throw new Error("Marker has no parent node");this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.customData.attached=!0}else{if(!e.parentNode)throw new Error("Element has no parent node");e.parentNode.removeChild(e),this.customData.attached=!1}},update:function(e){this.customData.nested&&this.customData.nested.update(e)}}};t.binders=o},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.adapter=t.Adapter=void 0;var a=["push","pop","shift","unshift","sort","reverse","splice"],o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"counter",0),i(this,"weakmap",{})}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"weakReference",value:function(e){if(!e.hasOwnProperty("__rv")){var t=this.counter++;Object.defineProperty(e,"__rv",{value:t})}return this.weakmap[e.__rv]||(this.weakmap[e.__rv]={callbacks:{}}),this.weakmap[e.__rv]}},{key:"cleanupWeakReference",value:function(e,t){Object.keys(e.callbacks).length||e.pointers&&Object.keys(e.pointers).length||delete this.weakmap[t]}},{key:"stubFunction",value:function(e,t){var r=e[t],n=this.weakReference(e),i=this.weakmap;e[t]=function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];var s=r.apply(e,a);return Object.keys(n.pointers).forEach(function(e){var t=n.pointers[e];i[e]&&i[e].callbacks[t]instanceof Array&&i[e].callbacks[t].forEach(function(e){e.sync()})}),s}}},{key:"observeMutations",value:function(e,t,r){var n=this;if(e instanceof Array){var i=this.weakReference(e);i.pointers||(i.pointers={},a.forEach(function(t){n.stubFunction(e,t)})),i.pointers[t]||(i.pointers[t]=[]),-1===i.pointers[t].indexOf(r)&&i.pointers[t].push(r)}}},{key:"unobserveMutations",value:function(e,t,r){if(e instanceof Array&&null!=e.__rv){var n=this.weakmap[e.__rv];if(n){var i=n.pointers[t];if(i){var a=i.indexOf(r);a>-1&&i.splice(a,1),i.length||delete n.pointers[t],this.cleanupWeakReference(n,e.__rv)}}}}},{key:"observe",value:function(e,t,r){var n,i=this,a=this.weakReference(e).callbacks;if(!a[t]){a[t]=[];var o=Object.getOwnPropertyDescriptor(e,t);o&&(o.get||o.set||!o.configurable)||(n=e[t],Object.defineProperty(e,t,{enumerable:!0,get:function(){return n},set:function(r){if(r!==n){i.unobserveMutations(n,e.__rv,t),n=r;var a=i.weakmap[e.__rv];if(a){var o=a.callbacks[t];o&&o.forEach(function(e){e.sync()}),i.observeMutations(r,e.__rv,t)}}}}))}-1===a[t].indexOf(r)&&a[t].push(r),this.observeMutations(e[t],e.__rv,t)}},{key:"unobserve",value:function(e,t,r){var n=this.weakmap[e.__rv];if(n){var i=n.callbacks[t];if(i){var a=i.indexOf(r);a>-1&&(i.splice(a,1),i.length||(delete n.callbacks[t],this.unobserveMutations(e[t],e.__rv,t))),this.cleanupWeakReference(n,e.__rv)}}}},{key:"get",value:function(e,t){return e[t]}},{key:"set",value:function(e,t,r){e[t]=r}}]),e}();t.Adapter=o;var s=new o;t.adapter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatters=void 0;var n={};t.formatters=n,n.not=function(e){return!e}}]).default});