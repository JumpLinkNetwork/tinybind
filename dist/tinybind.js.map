{"version":3,"file":"tinybind.js","sources":["../src/constants.js","../src/parsers.js","../src/tinybind.js","../src/observer.js","../src/binding.js","../src/component-binding.js","../src/view.js","../src/adapter.js","../src/binders.js","../src/export.js"],"sourcesContent":["export const OPTIONS = [\n  'prefix',\n  'templateDelimiters',\n  'rootInterface',\n  'preloadData',\n  'handler'\n];\n\nexport const EXTENSIONS = [\n  'binders',\n  'formatters',\n  'components',\n  'adapters'\n];","/**\n * Used also in parsers.parseType\n * TODO outsource\n */\nconst PRIMITIVE = 0;\nconst KEYPATH = 1;\n\nconst QUOTED_STR = /^'.*'$|^\".*\"$/; // regex to test if string is wrapped in \" or '\n\n// Used in parsers.parseTemplate\nconst TEXT = 0;\nconst BINDING = 1;\n\n// Test if string is a json string\nexport function isJson(str) {\n  try {\n    const val = JSON.parse(str);\n    return (val instanceof Array || val instanceof Object) ? true : false;\n  }\n  catch (error) {\n    return false;\n  }\n}\n\n// Parser and tokenizer for getting the type and value from a string.\nexport function parseType(string) {\n  let type = PRIMITIVE;\n  let value = string;\n  if (QUOTED_STR.test(string)) {\n    value = string.slice(1, -1);\n  } else if (string === 'true') {\n    value = true;\n  } else if (string === 'false') {\n    value = false;\n  } else if (string === 'null') {\n    value = null;\n  } else if (string === 'undefined') {\n    value = undefined;\n  } else if (!isNaN(string)) {\n    value = Number(string);\n  } else if (isJson(string)) {\n    value = JSON.parse(string);\n  } else {\n    type = KEYPATH;\n  }\n  return {type: type, value: value};\n}\n\n// Template parser and tokenizer for mustache-style text content bindings.\n// Parses the template and returns a set of tokens, separating static portions\n// of text from binding declarations.\nexport function parseTemplate(template, delimiters) {\n  var tokens;\n  let length = template.length;\n  let index = 0;\n  let lastIndex = 0;\n  let open = delimiters[0], close = delimiters[1];\n\n  while (lastIndex < length) {\n    index = template.indexOf(open, lastIndex);\n\n    if (index < 0) {\n      if (tokens) {\n        tokens.push({\n          type: TEXT,\n          value: template.slice(lastIndex)\n        });\n      }\n\n      break;\n    } else {\n      tokens = tokens || [];\n      if (index > 0 && lastIndex < index) {\n        tokens.push({\n          type: TEXT,\n          value: template.slice(lastIndex, index)\n        });\n      }\n\n      lastIndex = index + open.length;\n      index = template.indexOf(close, lastIndex);\n\n      if (index < 0) {\n        let substring = template.slice(lastIndex - close.length);\n        let lastToken = tokens[tokens.length - 1];\n\n        if (lastToken && lastToken.type === TEXT) {\n          lastToken.value += substring;\n        } else {\n          tokens.push({\n            type: TEXT,\n            value: substring\n          });\n        }\n\n        break;\n      }\n\n      let value = template.slice(lastIndex, index).trim();\n\n      tokens.push({\n        type: BINDING,\n        value: value\n      });\n\n      lastIndex = index + close.length;\n    }\n  }\n\n  return tokens;\n}\n","import {EXTENSIONS} from './constants';\nimport {parseTemplate, parseType} from './parsers';\n\nconst tinybind = {\n  // Global binders.\n  binders: {},\n\n  // Global components.\n  components: {},\n\n  // Global formatters.\n  formatters: {},\n\n  // Global sightglass adapters.\n  adapters: {},\n\n  // Default attribute prefix.\n  _prefix: 'rv',\n\n  _fullPrefix: 'rv-',\n\n  get prefix () {\n    return this._prefix;\n  },\n\n  set prefix (value) {\n    this._prefix = value;\n    this._fullPrefix = value + '-';\n  },\n\n  parseTemplate: parseTemplate,\n\n  parseType: parseType,\n\n  // Default template delimiters.\n  templateDelimiters: ['{', '}'],\n\n  // Default sightglass root interface.\n  rootInterface: '.',\n\n  // Preload data by default.\n  preloadData: true,\n\n  // Default event handler.\n  handler: function(context, ev, binding) {\n    this.call(context, ev, binding.view.models);\n  },\n\n  // Sets the attribute on the element. If no binder above is matched it will fall\n  // back to using this binder.\n  fallbackBinder: function(el, value) {\n    if (value != null) {\n      el.setAttribute(this.type, value);\n    } else {\n      el.removeAttribute(this.type);\n    }  \n  },\n\n  // Merges an object literal into the corresponding global options.\n  configure: function(options) {\n    if (!options) {\n      return;\n    }\n    Object.keys(options).forEach(option => {\n      let value = options[option];\n\n      if (EXTENSIONS.indexOf(option) > -1) {\n        Object.keys(value).forEach(key => {\n          this[option][key] = value[key];\n        });\n      } else {\n        this[option] = value;\n      }\n    });\n  }\n};\n\nexport default tinybind;\n","\n// Check if a value is an object than can be observed.\nfunction isObject(obj) {\n  return typeof obj === 'object' && obj !== null;\n}\n\n// Error thrower.\nfunction error(message) {\n  throw new Error('[Observer] ' + message);\n}\n\nvar adapters;\nvar interfaces;\nvar rootInterface;\n\n// Constructs a new keypath observer and kicks things off.\nfunction Observer(obj, keypath, callback) {\n  this.keypath = keypath;\n  this.callback = callback;\n  this.objectPath = [];\n  this.parse();\n  this.obj = this.getRootObject(obj);\n\n  if (isObject(this.target = this.realize())) {\n    this.set(true, this.key, this.target, this.callback);\n  }\n}\n\nObserver.updateOptions = function(options) {\n  adapters = options.adapters;\n  interfaces = Object.keys(adapters);\n  rootInterface = options.rootInterface;\n};\n\n// Tokenizes the provided keypath string into interface + path tokens for the\n// observer to work with.\nObserver.tokenize = function(keypath, root) {\n  var tokens = [];\n  var current = {i: root, path: ''};\n  var index, chr;\n\n  for (index = 0; index < keypath.length; index++) {\n    chr = keypath.charAt(index);\n\n    if (!!~interfaces.indexOf(chr)) {\n      tokens.push(current);\n      current = {i: chr, path: ''};\n    } else {\n      current.path += chr;\n    }\n  }\n\n  tokens.push(current);\n  return tokens;\n};\n\n// Parses the keypath using the interfaces defined on the view. Sets variables\n// for the tokenized keypath as well as the end key.\nObserver.prototype.parse = function() {\n  var path, root;\n\n  if (!interfaces.length) {\n    error('Must define at least one adapter interface.');\n  }\n\n  if (!!~interfaces.indexOf(this.keypath[0])) {\n    root = this.keypath[0];\n    path = this.keypath.substr(1);\n  } else {\n    root = rootInterface;\n    path = this.keypath;\n  }\n\n  this.tokens = Observer.tokenize(path, root);\n  this.key = this.tokens.pop();\n};\n\n// Realizes the full keypath, attaching observers for every key and correcting\n// old observers to any changed objects in the keypath.\nObserver.prototype.realize = function() {\n  var current = this.obj;\n  var unreached = -1;\n  var prev;\n  var token;\n\n  for (let index = 0; index < this.tokens.length; index++) {\n    token = this.tokens[index];\n    if (isObject(current)) {\n      if (typeof this.objectPath[index] !== 'undefined') {\n        if (current !== (prev = this.objectPath[index])) {\n          this.set(false, token, prev, this);\n          this.set(true, token, current, this);\n          this.objectPath[index] = current;\n        }\n      } else {\n        this.set(true, token, current, this);\n        this.objectPath[index] = current;\n      }\n\n      current = this.get(token, current);\n    } else {\n      if (unreached === -1) {\n        unreached = index;\n      }\n\n      prev = this.objectPath[index];\n      if (prev) {\n        this.set(false, token, prev, this);\n      }\n    }\n  }\n\n  if (unreached !== -1) {\n    this.objectPath.splice(unreached);\n  }\n\n  return current;\n};\n\n// Updates the keypath. This is called when any intermediary key is changed.\nObserver.prototype.sync = function() {\n  var next, oldValue, newValue;\n\n  if ((next = this.realize()) !== this.target) {\n    if (isObject(this.target)) {\n      this.set(false, this.key, this.target, this.callback);\n    }\n\n    if (isObject(next)) {\n      this.set(true, this.key, next, this.callback);\n    }\n\n    oldValue = this.value();\n    this.target = next;\n    newValue = this.value();\n    if (newValue !== oldValue || newValue instanceof Function) this.callback.sync();\n  } else if (next instanceof Array) {\n    this.callback.sync();\n  }\n};\n\n// Reads the current end value of the observed keypath. Returns undefined if\n// the full keypath is unreachable.\nObserver.prototype.value = function() {\n  if (isObject(this.target)) {\n    return this.get(this.key, this.target);\n  }\n};\n\n// Sets the current end value of the observed keypath. Calling setValue when\n// the full keypath is unreachable is a no-op.\nObserver.prototype.setValue = function(value) {\n  if (isObject(this.target)) {\n    adapters[this.key.i].set(this.target, this.key.path, value);\n  }\n};\n\n// Gets the provided key on an object.\nObserver.prototype.get = function(key, obj) {\n  return adapters[key.i].get(obj, key.path);\n};\n\n// Observes or unobserves a callback on the object using the provided key.\nObserver.prototype.set = function(active, key, obj, callback) {\n  var action = active ? 'observe' : 'unobserve';\n  adapters[key.i][action](obj, key.path, callback);\n};\n\n\n// Unobserves the entire keypath.\nObserver.prototype.unobserve = function() {\n  var obj;\n  var token;\n\n  for (let index = 0; index < this.tokens.length; index++) {\n    token = this.tokens[index];\n    obj = this.objectPath[index];\n    if (obj) {\n      this.set(false, token, obj, this);\n    }\n  }\n\n  if (isObject(this.target)) {\n    this.set(false, this.key, this.target, this.callback);\n  }\n};\n// traverse the scope chain to find the scope which has the root property\n// if the property is not found in chain, returns the root scope\nObserver.prototype.getRootObject = function (obj) {\n  var rootProp, current;\n  if (!obj.$parent) {\n    return obj;\n  }\n\n  if (this.tokens.length) {\n    rootProp = this.tokens[0].path;\n  } else {\n    rootProp = this.key.path;\n  }\n\n  current = obj;\n  while (current.$parent && (current[rootProp] === undefined)) {\n    current = current.$parent;\n  }\n\n  return current;\n};\n\nexport default Observer;\n","import {parseType} from './parsers';\nimport Observer from './observer';\n\nfunction getInputValue(el) {\n  let results = [];\n  if (el.type === 'checkbox') {\n    return el.checked;\n  } else if (el.type === 'select-multiple') {\n\n    el.options.forEach(option => {\n      if (option.selected) {\n        results.push(option.value);\n      }\n    });\n\n    return results;\n  } else {\n    return el.value;\n  }\n}\n\nconst FORMATTER_ARGS =  /[^\\s']+|'([^']|'[^\\s])*'|\"([^\"]|\"[^\\s])*\"/g;\nconst FORMATTER_SPLIT = /\\s+/;\n\n/**\n * Used also in parsers.parseType\n * TODO outsource\n */\nconst PRIMITIVE = 0;\nconst KEYPATH = 1;\n\n// A single binding between a model attribute and a DOM element.\nexport class Binding {\n  /**\n   * All information about the binding is passed into the constructor; the\n   * containing view, the DOM node, the type of binding, the model object and the\n   * keypath at which to listen for changes.\n   * @param {*} view \n   * @param {*} el \n   * @param {*} type \n   * @param {*} keypath \n   * @param {*} binder \n   * @param {*} args The start binders, on `class-*` args[0] wil be the classname \n   * @param {*} formatters \n   */\n  constructor(view, el, type, keypath, binder, args, formatters) {\n    this.view = view;\n    this.el = el;\n    this.type = type;\n    this.keypath = keypath;\n    this.binder = binder;\n    this.args = args;\n    this.formatters = formatters;\n    this.formatterObservers = {};\n    this.model = undefined;\n  }\n\n  // Observes the object keypath\n  observe(obj, keypath) {\n    return new Observer(obj, keypath, this);\n  }\n\n  parseTarget() {\n    if (this.keypath) {\n      let token = parseType(this.keypath);\n      if (token.type === PRIMITIVE) {\n        this.value = token.value;\n      } else if(token.type === KEYPATH){\n        this.observer = this.observe(this.view.models, this.keypath);\n        this.model = this.observer.target;\n      } else {\n        throw new Error('Unknown type in token', token);\n      }\n    } else {\n      this.value = undefined;\n    }\n  }\n  \n  /**\n   * Get the iteration alias, used in the interation binders like `each-*`\n   * @param {*} modelName \n   * @see https://github.com/mikeric/rivets/blob/master/dist/rivets.js#L26\n   * @see https://github.com/mikeric/rivets/blob/master/dist/rivets.js#L1175\n   */\n  getIterationAlias(modelName) {\n    return '%' + modelName + '%';\n  }\n\n  parseFormatterArguments(args, formatterIndex) {\n    return args\n      .map(parseType)\n      .map(({type, value}, ai) => {\n        if (type === PRIMITIVE) {\n          return value;\n        } else if (type === KEYPATH) {\n          if (!this.formatterObservers[formatterIndex]) {\n            this.formatterObservers[formatterIndex] = {};\n          }\n\n          let observer = this.formatterObservers[formatterIndex][ai];\n\n          if (!observer) {\n            observer = this.observe(this.view.models, value);\n            this.formatterObservers[formatterIndex][ai] = observer;\n          }\n\n          return observer.value();\n        } else {\n          throw new Error('Unknown type', type, value);\n        }\n      });\n  }\n\n  // Applies all the current formatters to the supplied value and returns the\n  // formatted value.\n  formattedValue(value) {\n    return this.formatters.reduce((result, declaration, index) => {\n      let args = declaration.match(FORMATTER_ARGS);\n      let id = args.shift();\n      let formatter = this.view.options.formatters[id];\n\n      const processedArgs = this.parseFormatterArguments(args, index);\n\n      if (formatter && (formatter.read instanceof Function)) {\n        result = formatter.read(result, ...processedArgs);\n      } else if (formatter instanceof Function) {\n        result = formatter(result, ...processedArgs);\n      }\n      return result;\n    }, value);\n  }\n\n  // Returns an event handler for the binding around the supplied function.\n  eventHandler(fn) {\n    let binding = this;\n    let handler = binding.view.options.handler;\n\n    return function(ev) {\n      handler.call(fn, this, ev, binding);\n    };\n  }\n\n  // Sets the value for the binding. This Basically just runs the binding routine\n  // with the supplied value formatted.\n  set(value) {\n    if ((value instanceof Function) && !this.binder.function) {\n      value = this.formattedValue(value.call(this.model));\n    } else {\n      value = this.formattedValue(value);\n    }\n\n    let routineFn = this.binder.routine || this.binder;\n\n    if (routineFn instanceof Function) {\n      routineFn.call(this, this.el, value);\n    }\n  }\n\n  // Syncs up the view binding with the model.\n  sync() {\n    if (this.observer) {\n      this.model = this.observer.target;\n      this.set(this.observer.value());\n    } else {\n      this.set(this.value);\n    }\n  }\n\n  // Publishes the value currently set on the input element back to the model.\n  publish() {\n    if (this.observer) {\n      var value = this.formatters.reduceRight((result, declaration, index) => {\n        const args = declaration.split(FORMATTER_SPLIT);\n        const id = args.shift();\n        const formatter = this.view.options.formatters[id];\n        const processedArgs = this.parseFormatterArguments(args, index);\n\n        if (formatter && formatter.publish) {\n          result = formatter.publish(result, ...processedArgs);\n        }\n        return result;\n      }, this.getValue(this.el));\n\n      this.observer.setValue(value);\n    }\n  }\n\n  // Subscribes to the model for changes at the specified keypath. Bi-directional\n  // routines will also listen for changes on the element to propagate them back\n  // to the model.\n  bind() {\n    this.parseTarget();\n\n    if (this.binder.hasOwnProperty('bind')) {\n      this.binder.bind.call(this, this.el);\n    }\n\n    if (this.view.options.preloadData) {\n      this.sync();\n    }\n  }\n\n  // Unsubscribes from the model and the element.\n  unbind() {\n    if (this.binder.unbind) {\n      this.binder.unbind.call(this, this.el);\n    }\n\n    if (this.observer) {\n      this.observer.unobserve();\n    }\n\n    Object.keys(this.formatterObservers).forEach(fi => {\n      let args = this.formatterObservers[fi];\n\n      Object.keys(args).forEach(ai => {\n        args[ai].unobserve();\n      });\n    });\n\n    this.formatterObservers = {};\n  }\n\n  // Updates the binding's model from what is currently set on the view. Unbinds\n  // the old model first and then re-binds with the new model.\n  update(models = {}) {\n    if (this.observer) {\n      this.model = this.observer.target;\n    }\n\n    if (this.binder.update) {\n      this.binder.update.call(this, models);\n    }\n  }\n\n  // Returns elements value\n  getValue(el) {\n    if (this.binder && this.binder.getValue) {\n      return this.binder.getValue.call(this, el);\n    } else {\n      return getInputValue(el);\n    }\n  }\n}\n","import tinybind from './tinybind';\nimport {parseType} from './parsers';\nimport {EXTENSIONS, OPTIONS} from './constants';\nimport {Binding} from './binding';\n\n/**\n * Used also in parsers.parseType\n * TODO outsource\n */\nconst PRIMITIVE = 0;\nconst KEYPATH = 1;\n\n// component view encapsulated as a binding within it's parent view.\nexport class ComponentBinding extends Binding {\n  // Initializes a component binding for the specified view. The raw component\n  // element is passed in along with the component type. Attributes and scope\n  // inflections are determined based on the components defined attributes.\n  constructor(view, el, type) {\n    super(view, el, type, null, null, null, null);\n    this.view = view;\n    this.el = el;\n    this.type = type;\n    this.component = view.options.components[this.type];\n    this.static = {};\n    this.observers = {};\n    this.upstreamObservers = {};\n    \n    let bindingPrefix = tinybind._fullPrefix;\n    \n    // parse component attributes\n    for (let i = 0, len = el.attributes.length; i < len; i++) {\n      let attribute = el.attributes[i];\n\n      // if attribute starts not with binding prefix. E.g. rv-\n      if (attribute.name.indexOf(bindingPrefix) !== 0) {\n        let propertyName = this.camelCase(attribute.name);\n        let token = parseType(attribute.value);\n        let stat = this.component.static;\n    \n        if (stat && stat.indexOf(propertyName) > -1) {\n          this.static[propertyName] = attribute.value;\n        } else if(token.type === PRIMITIVE) {\n          this.static[propertyName] = token.value;\n        } else if(token.type === KEYPATH) {\n          this.observers[propertyName] = attribute.value;\n        } else {\n          throw new Error('can\\'t parse component attribute', attribute, token);\n        }\n      }\n    }\n  }\n    \n    \n  // Intercepts `tinybind.Binding::sync` since component bindings are not bound to\n  // a particular model to update it's value.\n  sync() {}\n    \n  // Intercepts `tinybind.Binding::update` since component bindings are not bound\n  // to a particular model to update it's value.\n  update() {}\n    \n  // Intercepts `tinybind.Binding::publish` since component bindings are not bound\n  // to a particular model to update it's value.\n  publish() {}\n    \n  // Returns an object map using the component's scope inflections.\n  locals() {\n    let result = {};\n    \n    Object.keys(this.static).forEach(key => {\n      result[key] = this.static[key];\n    });\n    \n    Object.keys(this.observers).forEach(key => {\n      result[key] = this.observers[key].value();\n    });\n    \n    return result;\n  }\n    \n  // Returns a camel-cased version of the string. Used when translating an\n  // element's attribute name into a property name for the component's scope.\n  camelCase(string) {\n    return string.replace(/-([a-z])/g, grouped => {\n      return grouped[1].toUpperCase();\n    });\n  }\n    \n  // Intercepts `tinybind.Binding::bind` to build `@componentView` with a localized\n  // map of models from the root view. Bind `@componentView` on subsequent calls.\n  bind() {\n    var options = {};\n    if (!this.bound) {\n      Object.keys(this.observers).forEach(key => {\n        let keypath = this.observers[key];\n    \n        this.observers[key] = this.observe(this.view.models, keypath, (key => {\n          return () => {\n            this.componentView.models[key] = this.observers[key].value();\n          };\n        }).call(this, key));\n      });\n    \n      this.bound = true;\n    }\n    \n    if (this.componentView) {\n      this.componentView.bind();\n    } else {\n      this.el.innerHTML = this.component.template.call(this);\n      let scope = this.component.initialize.call(this, this.el, this.locals());\n      this.el._bound = true;\n    \n    \n      EXTENSIONS.forEach(extensionType => {\n        options[extensionType] = {};\n    \n        if (this.component[extensionType]) {\n          Object.keys(this.component[extensionType]).forEach(key => {\n            options[extensionType][key] = this.component[extensionType][key];\n          });\n        }\n    \n        Object.keys(this.view.options[extensionType]).forEach(key => {\n          if (options[extensionType][key]) {\n            options[extensionType][key] = this.view[extensionType][key];\n          }\n        });\n      });\n    \n      OPTIONS.forEach(option => {\n        if (this.component[option] != null) {\n          options[option] = this.component[option];\n        } else {\n          options[option] = this.view[option];\n        }\n      });\n    \n      //there's a cyclic dependency that makes imported View a dummy object. Use tinybind.bind\n      //this.componentView = new View(this.el, scope, options)\n      //this.componentView.bind()\n      this.componentView = tinybind.bind(Array.prototype.slice.call(this.el.childNodes), scope, options);\n    \n      Object.keys(this.observers).forEach(key => {\n        let observer = this.observers[key];\n        let models = this.componentView.models;\n    \n        let upstream = this.observe(models, key, ((key, observer) => {\n          return () => {\n            observer.setValue(this.componentView.models[key]);\n          };\n        }).call(this, key, observer));\n    \n        this.upstreamObservers[key] = upstream;\n      });\n    }\n  }\n    \n  // Intercept `tinybind.Binding::unbind` to be called on `@componentView`.\n  unbind() {\n    Object.keys(this.upstreamObservers).forEach(key => {\n      this.upstreamObservers[key].unobserve();\n    });\n    \n    Object.keys(this.observers).forEach(key => {\n      this.observers[key].unobserve();\n    });\n    \n    if (this.componentView) {\n      this.componentView.unbind.call(this);\n    }\n  }\n}","import tinybind from './tinybind';\nimport { Binding } from './binding';\nimport { ComponentBinding } from './component-binding';\nimport { parseTemplate } from './parsers';\n\nconst textBinder = {\n  routine: (node, value) => {\n    node.data = (value != null) ? value : '';\n  }\n};\n\nconst DECLARATION_SPLIT = /((?:'[^']*')*(?:(?:[^\\|']*(?:'[^']*')+[^\\|']*)+|[^\\|]+))|^$/g;\n\nconst parseNode = (view, node) => {\n  let block = false;\n\n  if (node.nodeType === 3) {\n    let tokens = parseTemplate(node.data, tinybind.templateDelimiters);\n\n    if (tokens) {\n      for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i];\n        let text = document.createTextNode(token.value);\n        node.parentNode.insertBefore(text, node);\n\n        if (token.type === 1) {\n          view.buildBinding(text, null, token.value, textBinder, null);\n        }\n      }\n\n      node.parentNode.removeChild(node);\n    }\n    block = true;\n  } else if (node.nodeType === 1) {\n    block = view.traverse(node);\n  }\n\n  if (!block) {\n    for (let i = 0; i < node.childNodes.length; i++) {\n      parseNode(view, node.childNodes[i]);\n    }\n  }\n};\n\nconst bindingComparator = (a, b) => {\n  let aPriority = a.binder ? (a.binder.priority || 0) : 0;\n  let bPriority = b.binder ? (b.binder.priority || 0) : 0;\n  return bPriority - aPriority;\n};\n\nconst trimStr = (str) => {\n  return str.trim();\n};\n\n// A collection of bindings built from a set of parent nodes.\nexport default class View {\n  // The DOM elements and the model objects for binding are passed into the\n  // constructor along with any local options that should be used throughout the\n  // context of the view and it's bindings.\n  constructor(els, models, options) {\n    if (els.jquery || els instanceof Array) {\n      this.els = els;\n    } else {\n      this.els = [els];\n    }\n\n    this.models = models;\n    this.options = options;\n\n    this.build();\n  }\n\n\n  buildBinding(node, type, declaration, binder, args) {\n    let pipes = declaration.match(DECLARATION_SPLIT).map(trimStr);\n    let keypath = pipes.shift();\n    this.bindings.push(new Binding(this, node, type, keypath, binder, args, pipes));\n  }\n\n  // Parses the DOM tree and builds `Binding` instances for every matched\n  // binding declaration.\n  build() {\n    this.bindings = [];\n\n    let elements = this.els, i, len;\n    for (i = 0, len = elements.length; i < len; i++) {\n      parseNode(this, elements[i]);\n    }\n\n    this.bindings.sort(bindingComparator);\n  }\n\n  traverse(node) {\n    let bindingPrefix = tinybind._fullPrefix;\n    let block = node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE';\n    let attributes = node.attributes;\n    let bindInfos = [];\n    let starBinders = this.options.starBinders;\n    var type, binder, identifier, args;\n\n\n    for (let i = 0, len = attributes.length; i < len; i++) {\n      let attribute = attributes[i];\n      // if attribute starts with the binding prefix. E.g. rv\n      if (attribute.name.indexOf(bindingPrefix) === 0) {\n        type = attribute.name.slice(bindingPrefix.length);\n        binder = this.options.binders[type];\n        args = [];\n\n        if (!binder) {\n          for (let k = 0; k < starBinders.length; k++) {\n            identifier = starBinders[k];\n            if (type.slice(0, identifier.length - 1) === identifier.slice(0, -1)) {\n              binder = this.options.binders[identifier];\n              args.push(type.slice(identifier.length - 1));\n              break;\n            }\n          }\n        }\n\n        if (!binder) {\n          binder = tinybind.fallbackBinder;\n        }\n\n        if (binder.block) {\n          this.buildBinding(node, type, attribute.value, binder, args);\n          node.removeAttribute(attribute.name);\n          return true;\n        }\n\n        bindInfos.push({attr: attribute, binder: binder, type: type, args: args});\n      }\n    }\n\n    for (let i = 0; i < bindInfos.length; i++) {\n      let bindInfo = bindInfos[i];\n      this.buildBinding(node, bindInfo.type, bindInfo.attr.value, bindInfo.binder, bindInfo.args);\n      node.removeAttribute(bindInfo.attr.name);\n    }\n\n    // bind components\n    if (!block) {\n      type = node.nodeName.toLowerCase();\n\n      if (this.options.components[type] && !node._bound) {\n        this.bindings.push(new ComponentBinding(this, node, type));\n        block = true;\n      }\n    }\n\n    return block;\n  }\n\n  // Binds all of the current bindings for this view.\n  bind() {\n    this.bindings.forEach(binding => {\n      binding.bind();\n    });\n  }\n\n  // Unbinds all of the current bindings for this view.\n  unbind() {\n    this.bindings.forEach(binding => {\n      binding.unbind();\n    });\n  }\n\n  // Syncs up the view with the model by running the routines on all bindings.\n  sync() {\n    this.bindings.forEach(binding => {\n      binding.sync();\n    });\n  }\n\n  // Publishes the input values from the view back to the model (reverse sync).\n  publish() {\n    this.bindings.forEach(binding => {\n      if (binding.binder && binding.binder.publishes) {\n        binding.publish();\n      }\n    });\n  }\n\n  // Updates the view's models along with any affected bindings.\n  update(models = {}) {\n    Object.keys(models).forEach(key => {\n      this.models[key] = models[key];\n    });\n\n    this.bindings.forEach(binding => {\n      if (binding.update) {\n        binding.update(models);\n      }\n    });\n  }\n}\n","// The default `.` adapter that comes with tinybind.js. Allows subscribing to\n// properties on plain objects, implemented in ES5 natives using\n// `Object.defineProperty`.\n\nconst ARRAY_METHODS = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'sort',\n  'reverse',\n  'splice'\n];\n\nconst adapter = {\n  counter: 0,\n  weakmap: {},\n\n  weakReference: function(obj) {\n    if (!obj.hasOwnProperty('__rv')) {\n      let id = this.counter++;\n\n      Object.defineProperty(obj, '__rv', {\n        value: id\n      });\n    }\n\n    if (!this.weakmap[obj.__rv]) {\n      this.weakmap[obj.__rv] = {\n        callbacks: {}\n      };\n    }\n\n    return this.weakmap[obj.__rv];\n  },\n\n  cleanupWeakReference: function(ref, id) {\n    if (!Object.keys(ref.callbacks).length) {\n      if (!(ref.pointers && Object.keys(ref.pointers).length)) {\n        delete this.weakmap[id];\n      }\n    }\n  },\n\n  stubFunction: function(obj, fn) {\n    let original = obj[fn];\n    let map = this.weakReference(obj);\n    let weakmap = this.weakmap;\n\n    obj[fn] = (...args) => {\n      let response = original.apply(obj, args);\n\n      Object.keys(map.pointers).forEach(r => {\n        let k = map.pointers[r];\n\n        if (weakmap[r]) {\n          if (weakmap[r].callbacks[k] instanceof Array) {\n            weakmap[r].callbacks[k].forEach(callback => {\n              callback.sync();\n            });\n          }\n        }\n      });\n\n      return response;\n    };\n  },\n\n  observeMutations: function(obj, ref, keypath) {\n    if (obj instanceof Array) {\n      let map = this.weakReference(obj);\n\n      if (!map.pointers) {\n        map.pointers = {};\n\n        ARRAY_METHODS.forEach(fn => {\n          this.stubFunction(obj, fn);\n        });\n      }\n\n      if (!map.pointers[ref]) {\n        map.pointers[ref] = [];\n      }\n\n      if (map.pointers[ref].indexOf(keypath) === -1) {\n        map.pointers[ref].push(keypath);\n      }\n    }\n  },\n\n  unobserveMutations: function(obj, ref, keypath) {\n    if ((obj instanceof Array) && (obj.__rv != null)) {\n      let map = this.weakmap[obj.__rv];\n\n      if (map) {\n        let pointers = map.pointers[ref];\n\n        if (pointers) {\n          let idx = pointers.indexOf(keypath);\n\n          if (idx > -1) {\n            pointers.splice(idx, 1);\n          }\n\n          if (!pointers.length) {\n            delete map.pointers[ref];\n          }\n\n          this.cleanupWeakReference(map, obj.__rv);\n        }\n      }\n    }\n  },\n\n  observe: function(obj, keypath, callback) {\n    var value;\n    let callbacks = this.weakReference(obj).callbacks;\n\n    if (!callbacks[keypath]) {\n      callbacks[keypath] = [];\n      let desc = Object.getOwnPropertyDescriptor(obj, keypath);\n\n      if (!desc || !(desc.get || desc.set || !desc.configurable)) {\n        value = obj[keypath];\n\n        Object.defineProperty(obj, keypath, {\n          enumerable: true,\n\n          get: () => {\n            return value;\n          },\n\n          set: newValue => {\n            if (newValue !== value) {\n              this.unobserveMutations(value, obj.__rv, keypath);\n              value = newValue;\n              let map = this.weakmap[obj.__rv];\n\n              if (map) {\n                let callbacks = map.callbacks[keypath];\n\n                if (callbacks) {\n                  callbacks.forEach(cb => {\n                      cb.sync();\n                  });\n                }\n\n                this.observeMutations(newValue, obj.__rv, keypath);\n              }\n            }\n          }\n        });\n      }\n    }\n\n    if (callbacks[keypath].indexOf(callback) === -1) {\n      callbacks[keypath].push(callback);\n    }\n\n    this.observeMutations(obj[keypath], obj.__rv, keypath);\n  },\n\n  unobserve: function(obj, keypath, callback) {\n    let map = this.weakmap[obj.__rv];\n\n    if (map) {\n      let callbacks = map.callbacks[keypath];\n\n      if (callbacks) {\n        let idx = callbacks.indexOf(callback);\n\n        if (idx > -1) {\n          callbacks.splice(idx, 1);\n\n          if (!callbacks.length) {\n            delete map.callbacks[keypath];\n            this.unobserveMutations(obj[keypath], obj.__rv, keypath);\n          }\n        }\n\n        this.cleanupWeakReference(map, obj.__rv);\n      }\n    }\n  },\n\n  get: function(obj, keypath) {\n    return obj[keypath];\n  },\n\n  set: (obj, keypath, value) => {\n    obj[keypath] = value;\n  }\n};\n\nexport default adapter;\n","import View from './view';\n\nconst getString = (value) => {\n  return value != null ? value.toString() : undefined;\n};\n\nconst times = (n, cb) => {\n  for (let i = 0; i < n; i++) cb();\n};\n\nfunction createView(binding, data, anchorEl) {\n  let template = binding.el.cloneNode(true);\n  let view = new View(template, data, binding.view.options);\n  view.bind();\n  binding.marker.parentNode.insertBefore(template, anchorEl);\n  return view;\n}\n\nconst binders = {\n  // Binds an event handler on the element.\n  'on-*': {\n    function: true,\n    priority: 1000,\n\n    unbind: function(el) {\n      if (this.handler) {\n        el.removeEventListener(this.args[0], this.handler);\n      }\n    },\n\n    routine: function(el, value) {\n      if (this.handler) {\n        el.removeEventListener(this.args[0], this.handler);\n      }\n\n      this.handler = this.eventHandler(value);\n      el.addEventListener(this.args[0], this.handler);\n    }\n  },\n\n  // Appends bound instances of the element in place for each item in the array.\n  'each-*': {\n    block: true,\n\n    priority: 4000,\n\n    bind(el) {\n      if (!this.marker) {\n        this.marker = document.createComment(` tinybind: ${this.type} `);\n        this.iterated = [];\n\n        el.parentNode.insertBefore(this.marker, el);\n        el.parentNode.removeChild(el);\n      } else {\n        this.iterated.forEach(view => {\n          view.bind();\n        });\n      }\n    },\n\n    unbind(el) {\n      if (this.iterated) {\n        this.iterated.forEach(view => {\n          view.unbind();\n        });\n      }\n    },\n\n    routine(el, collection) {\n      let modelName = this.args[0];\n      collection = collection || [];\n\n      // TODO support object keys to iterate over\n      if(!Array.isArray(collection)) {\n        throw new Error('each-' + modelName + ' needs an array to iterate over, but it is', collection);\n      }\n\n      // if index name is seted by `index-property` use this name, otherwise `%[modelName]%`  \n      let indexProp = el.getAttribute('index-property') || this.getIterationAlias(modelName);\n\n      collection.forEach((model, index) => {\n        let data = {$parent: this.view.models};\n        data[indexProp] = index;\n        data[modelName] = model;\n        let view = this.iterated[index];\n\n        if (!view) {\n\n          let previous = this.marker;\n\n          if (this.iterated.length) {\n            previous = this.iterated[this.iterated.length - 1].els[0];\n          }\n\n          view = createView(this, data, previous.nextSibling);\n          this.iterated.push(view);\n        } else {\n          if (view.models[modelName] !== model) {\n            // search for a view that matches the model\n            let matchIndex, nextView;\n            for (let nextIndex = index + 1; nextIndex < this.iterated.length; nextIndex++) {\n              nextView = this.iterated[nextIndex];\n              if (nextView.models[modelName] === model) {\n                matchIndex = nextIndex;\n                break;\n              }\n            }\n            if (matchIndex !== undefined) {\n              // model is in other position\n              // todo: consider avoiding the splice here by setting a flag\n              // profile performance before implementing such change\n              this.iterated.splice(matchIndex, 1);\n              this.marker.parentNode.insertBefore(nextView.els[0], view.els[0]);\n              nextView.models[indexProp] = index;\n            } else {\n              //new model\n              nextView = createView(this, data, view.els[0]);\n            }\n            this.iterated.splice(index, 0, nextView);\n          } else {\n            view.models[indexProp] = index;\n          }\n        }\n      });\n\n      if (this.iterated.length > collection.length) {\n        times(this.iterated.length - collection.length, () => {\n          let view = this.iterated.pop();\n          view.unbind();\n          this.marker.parentNode.removeChild(view.els[0]);\n        });\n      }\n\n      if (el.nodeName === 'OPTION') {\n        this.view.bindings.forEach(binding => {\n          if (binding.el === this.marker.parentNode && binding.type === 'value') {\n            binding.sync();\n          }\n        });\n      }\n    },\n\n    update(models) {\n      let data = {};\n\n      //todo: add test and fix if necessary\n\n      Object.keys(models).forEach(key => {\n        if (key !== this.args[0]) {\n          data[key] = models[key];\n        }\n      });\n\n      this.iterated.forEach(view => {\n        view.update(data);\n      });\n    }\n  },\n\n  // Adds or removes the class from the element when value is true or false.\n  'class-*': function(el, value) {\n    let elClass = ` ${el.className} `;\n\n    if (value !== (elClass.indexOf(` ${this.args[0]} `) > -1)) {\n      if (value) {\n        el.className = `${el.className} ${this.args[0]}`;\n      } else {\n        el.className = elClass.replace(` ${this.args[0]} `, ' ').trim();\n      }\n    }\n  },\n\n  // Sets the element's text value.\n  text: (el, value) => {\n    el.textContent = value != null ? value : '';\n  },\n\n  // Sets the element's HTML content.\n  html: (el, value) => {\n    el.innerHTML = value != null ? value : '';\n  },\n\n  // Shows the element when value is true.\n  show: (el, value) => {\n    el.style.display = value ? '' : 'none';\n  },\n\n  // Hides the element when value is true (negated version of `show` binder).\n  hide: (el, value) => {\n    el.style.display = value ? 'none' : '';\n  },\n\n  // Enables the element when value is true.\n  enabled: (el, value) => {\n    el.disabled = !value;\n  },\n\n  // Disables the element when value is true (negated version of `enabled` binder).\n  disabled: (el, value) => {\n    el.disabled = !!value;\n  },\n\n  // Checks a checkbox or radio input when the value is true. Also sets the model\n  // property when the input is checked or unchecked (two-way binder).\n  checked: {\n    publishes: true,\n    priority: 2000,\n\n    bind: function(el) {\n      var self = this;\n      if (!this.callback) {\n        this.callback = function () {\n          self.publish();\n        };\n      }\n      el.addEventListener('change', this.callback);\n    },\n\n    unbind: function(el) {\n      el.removeEventListener('change', this.callback);\n    },\n\n    routine: function(el, value) {\n      if (el.type === 'radio') {\n        el.checked = getString(el.value) === getString(value);\n      } else {\n        el.checked = !!value;\n      }\n    }\n  },\n\n  // Sets the element's value. Also sets the model property when the input changes\n  // (two-way binder).\n  value: {\n    publishes: true,\n    priority: 3000,\n\n    bind: function(el) {\n      this.isRadio = el.tagName === 'INPUT' && el.type === 'radio';\n      if (!this.isRadio) {\n        this.event = el.getAttribute('event-name') || (el.tagName === 'SELECT' ? 'change' : 'input');\n\n        var self = this;\n        if (!this.callback) {\n          this.callback = function () {\n            self.publish();\n          };\n        }\n\n        el.addEventListener(this.event, this.callback);\n      }\n    },\n\n    unbind: function(el) {\n      if (!this.isRadio) {\n        el.removeEventListener(this.event, this.callback);\n      }\n    },\n\n    routine: function(el, value) {\n      if (this.isRadio) {\n        el.setAttribute('value', value);\n      } else {\n        if (el.type === 'select-multiple') {\n          if (value instanceof Array) {\n            for (let i = 0; i < el.length; i++) {\n              let option = el[i];\n              option.selected = value.indexOf(option.value) > -1;\n            }\n          }\n        } else if (getString(value) !== getString(el.value)) {\n          el.value = value != null ? value : '';\n        }\n      }\n    }\n  },\n\n  // Inserts and binds the element and it's child nodes into the DOM when true.\n  if: {\n    block: true,\n    priority: 4000,\n\n    bind: function(el) {\n      if (!this.marker) {\n        this.marker = document.createComment(' tinybind: ' + this.type + ' ' + this.keypath + ' ');\n        this.attached = false;\n\n        el.parentNode.insertBefore(this.marker, el);\n        el.parentNode.removeChild(el);\n      } else if (this.bound === false && this.nested) {\n        this.nested.bind();\n      }\n      this.bound = true;\n    },\n\n    unbind: function() {\n      if (this.nested) {\n        this.nested.unbind();\n        this.bound = false;\n      }\n    },\n\n    routine: function(el, value) {\n      value = !!value;\n      if (value !== this.attached) {\n        if (value) {\n\n          if (!this.nested) {\n            this.nested = new View(el, this.view.models, this.view.options);\n            this.nested.bind();\n          }\n\n          this.marker.parentNode.insertBefore(el, this.marker.nextSibling);\n          this.attached = true;\n        } else {\n          el.parentNode.removeChild(el);\n          this.attached = false;\n        }\n      }\n    },\n\n    update: function(models) {\n      if (this.nested) {\n        this.nested.update(models);\n      }\n    }\n  }\n};\n\nexport default binders;\n","import tinybind from './tinybind';\nimport View from './view';\nimport {OPTIONS, EXTENSIONS} from './constants';\nimport adapter from './adapter';\nimport binders from './binders';\nimport Observer from './observer';\n\n// Returns the public interface.\n\ntinybind.binders = binders;\ntinybind.adapters['.'] = adapter;\n\n// Binds some data to a template / element. Returns a tinybind.View instance.\ntinybind.bind = (el, models, options) => {\n  let viewOptions = {};\n  models = models || {};\n  options = options || {};\n\n  EXTENSIONS.forEach(extensionType => {\n    viewOptions[extensionType] = Object.create(null);\n\n    if (options[extensionType]) {\n      Object.keys(options[extensionType]).forEach(key => {\n        viewOptions[extensionType][key] = options[extensionType][key];\n      });\n    }\n\n    Object.keys(tinybind[extensionType]).forEach(key => {\n      if (!viewOptions[extensionType][key]) {\n        viewOptions[extensionType][key] = tinybind[extensionType][key];\n      }\n    });\n  });\n\n  OPTIONS.forEach(option => {\n    let value = options[option];\n    viewOptions[option] = value != null ? value : tinybind[option];\n  });\n\n  viewOptions.starBinders = Object.keys(viewOptions.binders).filter(function (key) {\n    return key.indexOf('*') > 0;\n  });\n\n  Observer.updateOptions(viewOptions);\n\n  let view = new View(el, models, viewOptions);\n  view.bind();\n  return view;\n};\n\n// Initializes a new instance of a component on the specified element and\n// returns a tinybind.View instance.\t\t\ntinybind.init = (component, el, data = {}) => {\n  if (!el) {\n    el = document.createElement('div');\n  }\n\n  component = tinybind.components[component];\n  el.innerHTML = component.template.call(tinybind, el);\n  let scope = component.initialize.call(tinybind, el, data);\n\n  let view = tinybind.bind(el, scope);\n  view.bind();\n  return view;\n};\n\ntinybind.formatters.negate = tinybind.formatters.not = function (value) {\n  return !value;\n};\n\nexport default tinybind;\n"],"names":["OPTIONS","EXTENSIONS","PRIMITIVE","KEYPATH","QUOTED_STR","TEXT","BINDING","isJson","str","val","JSON","parse","Array","Object","error","parseType","string","type","value","test","slice","undefined","isNaN","Number","parseTemplate","template","delimiters","tokens","length","index","lastIndex","open","close","indexOf","push","substring","lastToken","trim","tinybind","binders","components","formatters","adapters","_prefix","_fullPrefix","prefix","templateDelimiters","rootInterface","preloadData","handler","context","ev","binding","call","view","models","fallbackBinder","el","setAttribute","removeAttribute","configure","options","keys","forEach","option","key","isObject","obj","message","Error","interfaces","Observer","keypath","callback","objectPath","getRootObject","target","realize","set","updateOptions","tokenize","root","current","i","path","chr","charAt","prototype","substr","pop","unreached","prev","token","get","splice","sync","next","oldValue","newValue","Function","setValue","active","action","unobserve","rootProp","$parent","getInputValue","results","checked","selected","FORMATTER_ARGS","FORMATTER_SPLIT","Binding","binder","args","formatterObservers","model","observe","parseTarget","observer","getIterationAlias","modelName","parseFormatterArguments","formatterIndex","map","ai","formattedValue","reduce","result","declaration","match","id","shift","formatter","processedArgs","read","eventHandler","fn","function","routineFn","routine","publish","reduceRight","split","getValue","bind","hasOwnProperty","unbind","fi","update","ComponentBinding","component","static","observers","upstreamObservers","bindingPrefix","len","attributes","attribute","name","propertyName","camelCase","stat","locals","replace","grouped","toUpperCase","bound","componentView","innerHTML","scope","initialize","_bound","extensionType","childNodes","upstream","textBinder","node","data","DECLARATION_SPLIT","parseNode","block","nodeType","text","document","createTextNode","parentNode","insertBefore","buildBinding","removeChild","traverse","bindingComparator","a","b","aPriority","priority","bPriority","trimStr","View","els","jquery","build","pipes","bindings","elements","sort","nodeName","bindInfos","starBinders","identifier","k","attr","bindInfo","toLowerCase","publishes","ARRAY_METHODS","adapter","counter","weakmap","weakReference","defineProperty","__rv","callbacks","cleanupWeakReference","ref","pointers","stubFunction","original","response","apply","r","observeMutations","unobserveMutations","idx","desc","getOwnPropertyDescriptor","configurable","enumerable","cb","getString","toString","times","n","createView","anchorEl","cloneNode","marker","removeEventListener","addEventListener","createComment","iterated","collection","isArray","indexProp","getAttribute","previous","nextSibling","matchIndex","nextView","nextIndex","elClass","className","textContent","html","show","style","display","hide","enabled","disabled","self","isRadio","tagName","event","if","attached","nested","viewOptions","create","filter","init","createElement","negate","not"],"mappings":"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"}