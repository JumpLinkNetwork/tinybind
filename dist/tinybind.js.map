{"version":3,"file":"tinybind.js","sources":["../src/constants.js","../src/parsers.js","../src/tinybind.js","../src/observer.js","../src/bindings.js","../src/view.js","../src/adapter.js","../src/binders.js","../src/export.js"],"sourcesContent":["export const OPTIONS = [\r\n  'prefix',\r\n  'templateDelimiters',\r\n  'rootInterface',\r\n  'preloadData',\r\n  'handler'\r\n]\r\n\r\nexport const EXTENSIONS = [\r\n  'binders',\r\n  'formatters',\r\n  'adapters'\r\n]","const PRIMITIVE = 0\r\nconst KEYPATH = 1\r\nconst TEXT = 0\r\nconst BINDING = 1\r\n\r\nconst QUOTED_STR = /^'.*'$|^\".*\"$/\r\n\r\n// Parser and tokenizer for getting the type and value from a string.\r\nexport function parseType(string) {\r\n  let type = PRIMITIVE\r\n  let value = string\r\n\r\n  if (QUOTED_STR.test(string)) {\r\n    value = string.slice(1, -1)\r\n  } else if (string === 'true') {\r\n    value = true\r\n  } else if (string === 'false') {\r\n    value = false\r\n  } else if (string === 'null') {\r\n    value = null\r\n  } else if (string === 'undefined') {\r\n    value = undefined\r\n  } else if (!isNaN(string)) {\r\n    value = Number(string)\r\n  } else {\r\n    type = KEYPATH\r\n  }\r\n\r\n  return {type: type, value: value}\r\n}\r\n\r\n// Template parser and tokenizer for mustache-style text content bindings.\r\n// Parses the template and returns a set of tokens, separating static portions\r\n// of text from binding declarations.\r\nexport function parseTemplate(template, delimiters) {\r\n  var tokens\r\n  let length = template.length\r\n  let index = 0\r\n  let lastIndex = 0\r\n  let open = delimiters[0], close = delimiters[1]\r\n\r\n  while (lastIndex < length) {\r\n    index = template.indexOf(open, lastIndex)\r\n\r\n    if (index < 0) {\r\n      if (tokens) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex)\r\n        })\r\n      }\r\n\r\n      break\r\n    } else {\r\n      tokens || (tokens = [])\r\n      if (index > 0 && lastIndex < index) {\r\n        tokens.push({\r\n          type: TEXT,\r\n          value: template.slice(lastIndex, index)\r\n        })\r\n      }\r\n\r\n      lastIndex = index + open.length\r\n      index = template.indexOf(close, lastIndex)\r\n\r\n      if (index < 0) {\r\n        let substring = template.slice(lastIndex - close.length)\r\n        let lastToken = tokens[tokens.length - 1]\r\n\r\n        if (lastToken && lastToken.type === TEXT) {\r\n          lastToken.value += substring\r\n        } else {\r\n          tokens.push({\r\n            type: TEXT,\r\n            value: substring\r\n          })\r\n        }\r\n\r\n        break\r\n      }\r\n\r\n      let value = template.slice(lastIndex, index).trim()\r\n\r\n      tokens.push({\r\n        type: BINDING,\r\n        value: value\r\n      })\r\n\r\n      lastIndex = index + close.length\r\n    }\r\n  }\r\n\r\n  return tokens\r\n}\r\n","import {EXTENSIONS} from './constants'\r\nimport {parseTemplate, parseType} from './parsers'\r\n\r\nconst tinybind = {\r\n  // Global binders.\r\n  binders: {},\r\n\r\n  // Global formatters.\r\n  formatters: {},\r\n\r\n  // Global sightglass adapters.\r\n  adapters: {},\r\n\r\n  // Default attribute prefix.\r\n  _prefix: 'rv',\r\n\r\n  _fullPrefix: 'rv-',\r\n\r\n  get prefix () {\r\n    return this._prefix\r\n  },\r\n\r\n  set prefix (value) {\r\n    this._prefix = value\r\n    this._fullPrefix = value + '-'\r\n  },\r\n\r\n  parseTemplate: parseTemplate,\r\n\r\n  parseType: parseType,\r\n\r\n  // Default template delimiters.\r\n  templateDelimiters: ['{', '}'],\r\n\r\n  // Default sightglass root interface.\r\n  rootInterface: '.',\r\n\r\n  // Preload data by default.\r\n  preloadData: true,\r\n\r\n  // Default event handler.\r\n  handler: function(context, ev, binding) {\r\n    this.call(context, ev, binding.view.models)\r\n  },\r\n\r\n  // Sets the attribute on the element. If no binder above is matched it will fall\r\n  // back to using this binder.\r\n  fallbackBinder: function(el, value) {\r\n    if (value != null) {\r\n      el.setAttribute(this.type, value)\r\n    } else {\r\n      el.removeAttribute(this.type)\r\n    }  \r\n  },\r\n\r\n  // Merges an object literal into the corresponding global options.\r\n  configure: function(options) {\r\n    if (!options) {\r\n      return\r\n    }\r\n    Object.keys(options).forEach(option => {\r\n      let value = options[option]\r\n\r\n      if (EXTENSIONS.indexOf(option) > -1) {\r\n        Object.keys(value).forEach(key => {\r\n          this[option][key] = value[key]\r\n        })\r\n      } else {\r\n        this[option] = value\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport default tinybind\r\n","\r\n// Check if a value is an object than can be observed.\r\nfunction isObject(obj) {\r\n  return typeof obj === 'object' && obj !== null\r\n}\r\n\r\n// Error thrower.\r\nfunction error(message) {\r\n  throw new Error('[Observer] ' + message)\r\n}\r\n\r\nvar adapters\r\nvar interfaces\r\nvar rootInterface\r\n\r\n// Constructs a new keypath observer and kicks things off.\r\nfunction Observer(obj, keypath, callback) {\r\n  this.keypath = keypath\r\n  this.callback = callback\r\n  this.objectPath = []\r\n  this.parse()\r\n  this.obj = this.getRootObject(obj)\r\n\r\n  if (isObject(this.target = this.realize())) {\r\n    this.set(true, this.key, this.target, this.callback)\r\n  }\r\n}\r\n\r\nObserver.updateOptions = function(options) {\r\n  adapters = options.adapters\r\n  interfaces = Object.keys(adapters)\r\n  rootInterface = options.rootInterface\r\n}\r\n\r\n// Tokenizes the provided keypath string into interface + path tokens for the\r\n// observer to work with.\r\nObserver.tokenize = function(keypath, root) {\r\n  var tokens = []\r\n  var current = {i: root, path: ''}\r\n  var index, chr\r\n\r\n  for (index = 0; index < keypath.length; index++) {\r\n    chr = keypath.charAt(index)\r\n\r\n    if (!!~interfaces.indexOf(chr)) {\r\n      tokens.push(current)\r\n      current = {i: chr, path: ''}\r\n    } else {\r\n      current.path += chr\r\n    }\r\n  }\r\n\r\n  tokens.push(current)\r\n  return tokens\r\n}\r\n\r\n// Parses the keypath using the interfaces defined on the view. Sets variables\r\n// for the tokenized keypath as well as the end key.\r\nObserver.prototype.parse = function() {\r\n  var path, root\r\n\r\n  if (!interfaces.length) {\r\n    error('Must define at least one adapter interface.')\r\n  }\r\n\r\n  if (!!~interfaces.indexOf(this.keypath[0])) {\r\n    root = this.keypath[0]\r\n    path = this.keypath.substr(1)\r\n  } else {\r\n    root = rootInterface\r\n    path = this.keypath\r\n  }\r\n\r\n  this.tokens = Observer.tokenize(path, root)\r\n  this.key = this.tokens.pop()\r\n}\r\n\r\n// Realizes the full keypath, attaching observers for every key and correcting\r\n// old observers to any changed objects in the keypath.\r\nObserver.prototype.realize = function() {\r\n  var current = this.obj\r\n  var unreached = -1\r\n  var prev\r\n  var token\r\n\r\n  for (let index = 0; index < this.tokens.length; index++) {\r\n    token = this.tokens[index]\r\n    if (isObject(current)) {\r\n      if (typeof this.objectPath[index] !== 'undefined') {\r\n        if (current !== (prev = this.objectPath[index])) {\r\n          this.set(false, token, prev, this)\r\n          this.set(true, token, current, this)\r\n          this.objectPath[index] = current\r\n        }\r\n      } else {\r\n        this.set(true, token, current, this)\r\n        this.objectPath[index] = current\r\n      }\r\n\r\n      current = this.get(token, current)\r\n    } else {\r\n      if (unreached === -1) {\r\n        unreached = index\r\n      }\r\n\r\n      if (prev = this.objectPath[index]) {\r\n        this.set(false, token, prev, this)\r\n      }\r\n    }\r\n  }\r\n\r\n  if (unreached !== -1) {\r\n    this.objectPath.splice(unreached)\r\n  }\r\n\r\n  return current\r\n}\r\n\r\n// Updates the keypath. This is called when any intermediary key is changed.\r\nObserver.prototype.sync = function() {\r\n  var next, oldValue, newValue\r\n\r\n  if ((next = this.realize()) !== this.target) {\r\n    if (isObject(this.target)) {\r\n      this.set(false, this.key, this.target, this.callback)\r\n    }\r\n\r\n    if (isObject(next)) {\r\n      this.set(true, this.key, next, this.callback)\r\n    }\r\n\r\n    oldValue = this.value()\r\n    this.target = next\r\n    newValue = this.value()\r\n    if (newValue !== oldValue || newValue instanceof Function) this.callback.sync()\r\n  } else if (next instanceof Array) {\r\n    this.callback.sync()\r\n  }\r\n}\r\n\r\n// Reads the current end value of the observed keypath. Returns undefined if\r\n// the full keypath is unreachable.\r\nObserver.prototype.value = function() {\r\n  if (isObject(this.target)) {\r\n    return this.get(this.key, this.target)\r\n  }\r\n}\r\n\r\n// Sets the current end value of the observed keypath. Calling setValue when\r\n// the full keypath is unreachable is a no-op.\r\nObserver.prototype.setValue = function(value) {\r\n  if (isObject(this.target)) {\r\n    adapters[this.key.i].set(this.target, this.key.path, value)\r\n  }\r\n}\r\n\r\n// Gets the provided key on an object.\r\nObserver.prototype.get = function(key, obj) {\r\n  return adapters[key.i].get(obj, key.path)\r\n}\r\n\r\n// Observes or unobserves a callback on the object using the provided key.\r\nObserver.prototype.set = function(active, key, obj, callback) {\r\n  var action = active ? 'observe' : 'unobserve'\r\n  adapters[key.i][action](obj, key.path, callback)\r\n}\r\n\r\n\r\n// Unobserves the entire keypath.\r\nObserver.prototype.unobserve = function() {\r\n  var obj\r\n  var token\r\n\r\n  for (let index = 0; index < this.tokens.length; index++) {\r\n    token = this.tokens[index]\r\n    if (obj = this.objectPath[index]) {\r\n      this.set(false, token, obj, this)\r\n    }\r\n  }\r\n\r\n  if (isObject(this.target)) {\r\n    this.set(false, this.key, this.target, this.callback)\r\n  }\r\n}\r\n// traverse the scope chain to find the scope which has the root property\r\n// if the property is not found in chain, returns the root scope\r\nObserver.prototype.getRootObject = function (obj) {\r\n  var rootProp, current;\r\n  if (!obj.$parent) {\r\n    return obj;\r\n  }\r\n\r\n  if (this.tokens.length) {\r\n    rootProp = this.tokens[0].path\r\n  } else {\r\n    rootProp = this.key.path\r\n  }\r\n\r\n  current = obj;\r\n  while (current.$parent && (current[rootProp] === undefined)) {\r\n    current = current.$parent\r\n  }\r\n\r\n  return current;\r\n}\r\n\r\nexport default Observer\r\n","import {parseType} from './parsers'\r\nimport Observer from './observer'\r\n\r\nfunction getInputValue(el) {\r\n  let results = []\r\n  if (el.type === 'checkbox') {\r\n    return el.checked\r\n  } else if (el.type === 'select-multiple') {\r\n\r\n    el.options.forEach(option => {\r\n      if (option.selected) {\r\n        results.push(option.value)\r\n      }\r\n    })\r\n\r\n    return results\r\n  } else {\r\n    return el.value\r\n  }\r\n}\r\n\r\nconst FORMATTER_ARGS =  /[^\\s']+|'([^']|'[^\\s])*'|\"([^\"]|\"[^\\s])*\"/g\r\nconst FORMATTER_SPLIT = /\\s+/\r\n\r\n// A single binding between a model attribute and a DOM element.\r\nexport class Binding {\r\n  // All information about the binding is passed into the constructor; the\r\n  // containing view, the DOM node, the type of binding, the model object and the\r\n  // keypath at which to listen for changes.\r\n  constructor(view, el, type, keypath, binder, arg, formatters) {\r\n    this.view = view\r\n    this.el = el\r\n    this.type = type\r\n    this.keypath = keypath\r\n    this.binder = binder\r\n    this.arg = arg\r\n    this.formatters = formatters\r\n    this.formatterObservers = {}\r\n    this.model = undefined\r\n  }\r\n\r\n  // Observes the object keypath\r\n  observe(obj, keypath) {\r\n    return new Observer(obj, keypath, this)\r\n  }\r\n\r\n  parseTarget() {\r\n    if (this.keypath) {\r\n      let token = parseType(this.keypath)\r\n\r\n      if (token.type === 0) {\r\n        this.value = token.value\r\n      } else {\r\n        this.observer = this.observe(this.view.models, this.keypath)\r\n        this.model = this.observer.target\r\n      }\r\n    } else {\r\n      this.value = undefined;\r\n    }\r\n  }\r\n\r\n  parseFormatterArguments(args, formatterIndex) {\r\n    return args\r\n      .map(parseType)\r\n      .map(({type, value}, ai) => {\r\n        if (type === 0) {\r\n          return value\r\n        } else {\r\n          if (!this.formatterObservers[formatterIndex]) {\r\n            this.formatterObservers[formatterIndex] = {}\r\n          }\r\n\r\n          let observer = this.formatterObservers[formatterIndex][ai]\r\n\r\n          if (!observer) {\r\n            observer = this.observe(this.view.models, value)\r\n            this.formatterObservers[formatterIndex][ai] = observer\r\n          }\r\n\r\n          return observer.value()\r\n        }\r\n      })\r\n  }\r\n\r\n  // Applies all the current formatters to the supplied value and returns the\r\n  // formatted value.\r\n  formattedValue(value) {\r\n    return this.formatters.reduce((result, declaration, index) => {\r\n      let args = declaration.match(FORMATTER_ARGS)\r\n      let id = args.shift()\r\n      let formatter = this.view.options.formatters[id]\r\n\r\n      const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n      if (formatter && (formatter.read instanceof Function)) {\r\n        result = formatter.read(result, ...processedArgs)\r\n      } else if (formatter instanceof Function) {\r\n        result = formatter(result, ...processedArgs)\r\n      }\r\n      return result\r\n    }, value)\r\n  }\r\n\r\n  // Returns an event handler for the binding around the supplied function.\r\n  eventHandler(fn) {\r\n    let binding = this\r\n    let handler = binding.view.options.handler\r\n\r\n    return function(ev) {\r\n      handler.call(fn, this, ev, binding)\r\n    }\r\n  }\r\n\r\n  // Sets the value for the binding. This Basically just runs the binding routine\r\n  // with the supplied value formatted.\r\n  set(value) {\r\n    if ((value instanceof Function) && !this.binder.function) {\r\n      value = this.formattedValue(value.call(this.model))\r\n    } else {\r\n      value = this.formattedValue(value)\r\n    }\r\n\r\n    let routineFn = this.binder.routine || this.binder\r\n\r\n    if (routineFn instanceof Function) {\r\n      routineFn.call(this, this.el, value)\r\n    }\r\n  }\r\n\r\n  // Syncs up the view binding with the model.\r\n  sync() {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n      this.set(this.observer.value())\r\n    } else {\r\n      this.set(this.value)\r\n    }\r\n  }\r\n\r\n  // Publishes the value currently set on the input element back to the model.\r\n  publish() {\r\n    if (this.observer) {\r\n      var value = this.formatters.reduceRight((result, declaration, index) => {\r\n        const args = declaration.split(FORMATTER_SPLIT)\r\n        const id = args.shift()\r\n        const formatter = this.view.options.formatters[id]\r\n        const processedArgs = this.parseFormatterArguments(args, index)\r\n\r\n        if (formatter && formatter.publish) {\r\n          result = formatter.publish(result, ...processedArgs)\r\n        }\r\n        return result\r\n      }, this.getValue(this.el))\r\n\r\n      this.observer.setValue(value)\r\n    }\r\n  }\r\n\r\n  // Subscribes to the model for changes at the specified keypath. Bi-directional\r\n  // routines will also listen for changes on the element to propagate them back\r\n  // to the model.\r\n  bind() {\r\n    this.parseTarget()\r\n\r\n    if (this.binder.hasOwnProperty('bind')) {\r\n      this.binder.bind.call(this, this.el)\r\n    }\r\n\r\n    if (this.view.options.preloadData) {\r\n      this.sync()\r\n    }\r\n  }\r\n\r\n  // Unsubscribes from the model and the element.\r\n  unbind() {\r\n    if (this.binder.unbind) {\r\n      this.binder.unbind.call(this, this.el)\r\n    }\r\n\r\n    if (this.observer) {\r\n      this.observer.unobserve()\r\n    }\r\n\r\n    Object.keys(this.formatterObservers).forEach(fi => {\r\n      let args = this.formatterObservers[fi]\r\n\r\n      Object.keys(args).forEach(ai => {\r\n        args[ai].unobserve()\r\n      })\r\n    })\r\n\r\n    this.formatterObservers = {}\r\n  }\r\n\r\n  // Updates the binding's model from what is currently set on the view. Unbinds\r\n  // the old model first and then re-binds with the new model.\r\n  update(models = {}) {\r\n    if (this.observer) {\r\n      this.model = this.observer.target\r\n    }\r\n\r\n    if (this.binder.update) {\r\n      this.binder.update.call(this, models)\r\n    }\r\n  }\r\n\r\n  // Returns elements value\r\n  getValue(el) {\r\n    if (this.binder && this.binder.getValue) {\r\n      return this.binder.getValue.call(this, el)\r\n    } else {\r\n      return getInputValue(el)\r\n    }\r\n  }\r\n}\r\n","import tinybind from './tinybind'\r\nimport {Binding} from './bindings'\r\nimport {parseTemplate} from './parsers'\r\n\r\nconst textBinder = {\r\n  routine: (node, value) => {\r\n    node.data = (value != null) ? value : ''\r\n  }\r\n}\r\n\r\nconst DECLARATION_SPLIT = /((?:'[^']*')*(?:(?:[^\\|']*(?:'[^']*')+[^\\|']*)+|[^\\|]+))|^$/g\r\n\r\nconst parseNode = (view, node) => {\r\n  let block = false\r\n\r\n  if (node.nodeType === 3) {\r\n    let tokens = parseTemplate(node.data, tinybind.templateDelimiters)\r\n\r\n    if (tokens) {\r\n      for (let i = 0; i < tokens.length; i++) {\r\n        let token = tokens[i]\r\n        let text = document.createTextNode(token.value)\r\n        node.parentNode.insertBefore(text, node)\r\n\r\n        if (token.type === 1) {\r\n          view.buildBinding(text, null, token.value, textBinder, null)\r\n        }\r\n      }\r\n\r\n      node.parentNode.removeChild(node)\r\n    }\r\n    block = true\r\n  } else if (node.nodeType === 1) {\r\n    block = view.traverse(node)\r\n  }\r\n\r\n  if (!block) {\r\n    for (let i = 0; i < node.childNodes.length; i++) {\r\n      parseNode(view, node.childNodes[i]);\r\n    }\r\n  }\r\n}\r\n\r\nconst bindingComparator = (a, b) => {\r\n  let aPriority = a.binder ? (a.binder.priority || 0) : 0\r\n  let bPriority = b.binder ? (b.binder.priority || 0) : 0\r\n  return bPriority - aPriority\r\n}\r\n\r\nconst trimStr = (str) => {\r\n  return str.trim()\r\n}\r\n\r\n// A collection of bindings built from a set of parent nodes.\r\nexport default class View {\r\n  // The DOM elements and the model objects for binding are passed into the\r\n  // constructor along with any local options that should be used throughout the\r\n  // context of the view and it's bindings.\r\n  constructor(els, models, options) {\r\n    if (els.jquery || els instanceof Array) {\r\n      this.els = els\r\n    } else {\r\n      this.els = [els]\r\n    }\r\n\r\n    this.models = models\r\n    this.options = options\r\n\r\n    this.build()\r\n  }\r\n\r\n\r\n  buildBinding(node, type, declaration, binder, arg) {\r\n    let pipes = declaration.match(DECLARATION_SPLIT).map(trimStr)\r\n\r\n    let keypath = pipes.shift()\r\n\r\n    this.bindings.push(new Binding(this, node, type, keypath, binder, arg, pipes))\r\n  }\r\n\r\n  // Parses the DOM tree and builds `Binding` instances for every matched\r\n  // binding declaration.\r\n  build() {\r\n    this.bindings = []\r\n\r\n    let elements = this.els, i, len;\r\n    for (i = 0, len = elements.length; i < len; i++) {\r\n      parseNode(this, elements[i])\r\n    }\r\n\r\n    this.bindings.sort(bindingComparator)\r\n  }\r\n\r\n  traverse(node) {\r\n    let bindingPrefix = tinybind._fullPrefix\r\n    let block = node.nodeName === 'SCRIPT' || node.nodeName === 'STYLE'\r\n    let attributes = node.attributes\r\n    let bindInfos = []\r\n    let starBinders = this.options.starBinders\r\n    var type, binder, identifier, arg\r\n\r\n\r\n    for (let i = 0, len = attributes.length; i < len; i++) {\r\n      let attribute = attributes[i]\r\n      if (attribute.name.indexOf(bindingPrefix) === 0) {\r\n        type = attribute.name.slice(bindingPrefix.length)\r\n        binder = this.options.binders[type]\r\n        arg = undefined\r\n\r\n        if (!binder) {\r\n          for (let k = 0; k < starBinders.length; k++) {\r\n            identifier = starBinders[k]\r\n            if (type.slice(0, identifier.length - 1) === identifier.slice(0, -1)) {\r\n              binder = this.options.binders[identifier]\r\n              arg = type.slice(identifier.length - 1)\r\n              break\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!binder) {\r\n          binder = tinybind.fallbackBinder\r\n        }\r\n\r\n        if (binder.block) {\r\n          this.buildBinding(node, type, attribute.value, binder, arg)\r\n          node.removeAttribute(attribute.name)\r\n          return true;\r\n        }\r\n\r\n        bindInfos.push({attr: attribute, binder: binder, type: type, arg: arg})\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < bindInfos.length; i++) {\r\n      let bindInfo = bindInfos[i]\r\n      this.buildBinding(node, bindInfo.type, bindInfo.attr.value, bindInfo.binder, bindInfo.arg)\r\n      node.removeAttribute(bindInfo.attr.name)\r\n    }\r\n\r\n    return block\r\n  }\r\n\r\n  // Binds all of the current bindings for this view.\r\n  bind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.bind()\r\n    })\r\n  }\r\n\r\n  // Unbinds all of the current bindings for this view.\r\n  unbind() {\r\n    this.bindings.forEach(binding => {\r\n      binding.unbind()\r\n    })\r\n  }\r\n\r\n  // Syncs up the view with the model by running the routines on all bindings.\r\n  sync() {\r\n    this.bindings.forEach(binding => {\r\n      binding.sync()\r\n    })\r\n  }\r\n\r\n  // Publishes the input values from the view back to the model (reverse sync).\r\n  publish() {\r\n    this.bindings.forEach(binding => {\r\n      if (binding.binder && binding.binder.publishes) {\r\n        binding.publish()\r\n      }\r\n    })\r\n  }\r\n\r\n  // Updates the view's models along with any affected bindings.\r\n  update(models = {}) {\r\n    Object.keys(models).forEach(key => {\r\n      this.models[key] = models[key]\r\n    })\r\n\r\n    this.bindings.forEach(binding => {\r\n      if (binding.update) {\r\n        binding.update(models)\r\n      }\r\n    })\r\n  }\r\n}\r\n","// The default `.` adapter that comes with tinybind.js. Allows subscribing to\r\n// properties on plain objects, implemented in ES5 natives using\r\n// `Object.defineProperty`.\r\n\r\nconst ARRAY_METHODS = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'sort',\r\n  'reverse',\r\n  'splice'\r\n]\r\n\r\nconst adapter = {\r\n  counter: 0,\r\n  weakmap: {},\r\n\r\n  weakReference: function(obj) {\r\n    if (!obj.hasOwnProperty('__rv')) {\r\n      let id = this.counter++\r\n\r\n      Object.defineProperty(obj, '__rv', {\r\n        value: id\r\n      })\r\n    }\r\n\r\n    if (!this.weakmap[obj.__rv]) {\r\n      this.weakmap[obj.__rv] = {\r\n        callbacks: {}\r\n      }\r\n    }\r\n\r\n    return this.weakmap[obj.__rv]\r\n  },\r\n\r\n  cleanupWeakReference: function(ref, id) {\r\n    if (!Object.keys(ref.callbacks).length) {\r\n      if (!(ref.pointers && Object.keys(ref.pointers).length)) {\r\n        delete this.weakmap[id]\r\n      }\r\n    }\r\n  },\r\n\r\n  stubFunction: function(obj, fn) {\r\n    let original = obj[fn]\r\n    let map = this.weakReference(obj)\r\n    let weakmap = this.weakmap\r\n\r\n    obj[fn] = (...args) => {\r\n      let response = original.apply(obj, args)\r\n\r\n      Object.keys(map.pointers).forEach(r => {\r\n        let k = map.pointers[r]\r\n\r\n        if (weakmap[r]) {\r\n          if (weakmap[r].callbacks[k] instanceof Array) {\r\n            weakmap[r].callbacks[k].forEach(callback => {\r\n              callback.sync()\r\n            })\r\n          }\r\n        }\r\n      })\r\n\r\n      return response\r\n    }\r\n  },\r\n\r\n  observeMutations: function(obj, ref, keypath) {\r\n    if (obj instanceof Array) {\r\n      let map = this.weakReference(obj)\r\n\r\n      if (!map.pointers) {\r\n        map.pointers = {}\r\n\r\n        ARRAY_METHODS.forEach(fn => {\r\n          this.stubFunction(obj, fn)\r\n        })\r\n      }\r\n\r\n      if (!map.pointers[ref]) {\r\n        map.pointers[ref] = []\r\n      }\r\n\r\n      if (map.pointers[ref].indexOf(keypath) === -1) {\r\n        map.pointers[ref].push(keypath)\r\n      }\r\n    }\r\n  },\r\n\r\n  unobserveMutations: function(obj, ref, keypath) {\r\n    if ((obj instanceof Array) && (obj.__rv != null)) {\r\n      let map = this.weakmap[obj.__rv]\r\n\r\n      if (map) {\r\n        let pointers = map.pointers[ref]\r\n\r\n        if (pointers) {\r\n          let idx = pointers.indexOf(keypath)\r\n\r\n          if (idx > -1) {\r\n            pointers.splice(idx, 1)\r\n          }\r\n\r\n          if (!pointers.length) {\r\n            delete map.pointers[ref]\r\n          }\r\n\r\n          this.cleanupWeakReference(map, obj.__rv)\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  observe: function(obj, keypath, callback) {\r\n    var value;\r\n    let callbacks = this.weakReference(obj).callbacks\r\n\r\n    if (!callbacks[keypath]) {\r\n      callbacks[keypath] = []\r\n      let desc = Object.getOwnPropertyDescriptor(obj, keypath)\r\n\r\n      if (!desc || !(desc.get || desc.set || !desc.configurable)) {\r\n        value = obj[keypath]\r\n\r\n        Object.defineProperty(obj, keypath, {\r\n          enumerable: true,\r\n\r\n          get: () => {\r\n            return value\r\n          },\r\n\r\n          set: newValue => {\r\n            if (newValue !== value) {\r\n              this.unobserveMutations(value, obj.__rv, keypath)\r\n              value = newValue\r\n              let map = this.weakmap[obj.__rv]\r\n\r\n              if (map) {\r\n                let callbacks = map.callbacks[keypath]\r\n\r\n                if (callbacks) {\r\n                  callbacks.forEach(cb => {\r\n                      cb.sync()\r\n                  })\r\n                }\r\n\r\n                this.observeMutations(newValue, obj.__rv, keypath)\r\n              }\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    if (callbacks[keypath].indexOf(callback) === -1) {\r\n      callbacks[keypath].push(callback)\r\n    }\r\n\r\n    this.observeMutations(obj[keypath], obj.__rv, keypath)\r\n  },\r\n\r\n  unobserve: function(obj, keypath, callback) {\r\n    let map = this.weakmap[obj.__rv]\r\n\r\n    if (map) {\r\n      let callbacks = map.callbacks[keypath]\r\n\r\n      if (callbacks) {\r\n        let idx = callbacks.indexOf(callback)\r\n\r\n        if (idx > -1) {\r\n          callbacks.splice(idx, 1)\r\n\r\n          if (!callbacks.length) {\r\n            delete map.callbacks[keypath]\r\n            this.unobserveMutations(obj[keypath], obj.__rv, keypath)\r\n          }\r\n        }\r\n\r\n        this.cleanupWeakReference(map, obj.__rv)\r\n      }\r\n    }\r\n  },\r\n\r\n  get: function(obj, keypath) {\r\n    return obj[keypath]\r\n  },\r\n\r\n  set: (obj, keypath, value) => {\r\n    obj[keypath] = value\r\n  }\r\n}\r\n\r\nexport default adapter\r\n","import View from './view'\r\n\r\nconst getString = (value) => {\r\n  return value != null ? value.toString() : undefined\r\n}\r\n\r\nconst times = (n, cb) => {\r\n  for (let i = 0; i < n; i++) cb()\r\n}\r\n\r\nfunction createView(binding, data, anchorEl) {\r\n  let template = binding.el.cloneNode(true)\r\n  let view = new View(template, data, binding.view.options)\r\n  view.bind()\r\n  binding.marker.parentNode.insertBefore(template, anchorEl)\r\n  return view\r\n}\r\n\r\nconst binders = {\r\n  // Binds an event handler on the element.\r\n  'on-*': {\r\n    function: true,\r\n    priority: 1000,\r\n\r\n    unbind: function(el) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.handler) {\r\n        el.removeEventListener(this.arg, this.handler)\r\n      }\r\n\r\n      this.handler = this.eventHandler(value)\r\n      el.addEventListener(this.arg, this.handler)\r\n    }\r\n  },\r\n\r\n  // Appends bound instances of the element in place for each item in the array.\r\n  'each-*': {\r\n    block: true,\r\n\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(` tinybind: ${this.type} `)\r\n        this.iterated = []\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else {\r\n        this.iterated.forEach(view => {\r\n          view.bind()\r\n        })\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (this.iterated) {\r\n        this.iterated.forEach(view => {\r\n          view.unbind()\r\n        })\r\n      }\r\n    },\r\n\r\n    routine: function(el, collection) {\r\n      let modelName = this.arg\r\n      collection = collection || []\r\n      let indexProp = el.getAttribute('index-property') || '$index'\r\n\r\n      collection.forEach((model, index) => {\r\n        let data = {$parent: this.view.models}\r\n        data[indexProp] = index\r\n        data[modelName] = model\r\n        let view = this.iterated[index]\r\n\r\n        if (!view) {\r\n\r\n          let previous = this.marker\r\n\r\n          if (this.iterated.length) {\r\n            previous = this.iterated[this.iterated.length - 1].els[0]\r\n          }\r\n\r\n          view = createView(this, data, previous.nextSibling)\r\n          this.iterated.push(view)\r\n        } else {\r\n          if (view.models[modelName] !== model) {\r\n            // search for a view that matches the model\r\n            let matchIndex, nextView\r\n            for (let nextIndex = index + 1; nextIndex < this.iterated.length; nextIndex++) {\r\n              nextView = this.iterated[nextIndex]\r\n              if (nextView.models[modelName] === model) {\r\n                matchIndex = nextIndex\r\n                break\r\n              }\r\n            }\r\n            if (matchIndex !== undefined) {\r\n              // model is in other position\r\n              // todo: consider avoiding the splice here by setting a flag\r\n              // profile performance before implementing such change\r\n              this.iterated.splice(matchIndex, 1)\r\n              this.marker.parentNode.insertBefore(nextView.els[0], view.els[0])\r\n              nextView.models[indexProp] = index\r\n            } else {\r\n              //new model\r\n              nextView = createView(this, data, view.els[0])\r\n            }\r\n            this.iterated.splice(index, 0, nextView)\r\n          } else {\r\n            view.models[indexProp] = index\r\n          }\r\n        }\r\n      })\r\n\r\n      if (this.iterated.length > collection.length) {\r\n        times(this.iterated.length - collection.length, () => {\r\n          let view = this.iterated.pop()\r\n          view.unbind()\r\n          this.marker.parentNode.removeChild(view.els[0])\r\n        })\r\n      }\r\n\r\n      if (el.nodeName === 'OPTION') {\r\n        this.view.bindings.forEach(binding => {\r\n          if (binding.el === this.marker.parentNode && binding.type === 'value') {\r\n            binding.sync()\r\n          }\r\n        })\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      let data = {}\r\n\r\n      //todo: add test and fix if necessary\r\n\r\n      Object.keys(models).forEach(key => {\r\n        if (key !== this.arg) {\r\n          data[key] = models[key]\r\n        }\r\n      })\r\n\r\n      this.iterated.forEach(view => {\r\n        view.update(data)\r\n      })\r\n    }\r\n  },\r\n\r\n  // Adds or removes the class from the element when value is true or false.\r\n  'class-*': function(el, value) {\r\n    let elClass = ` ${el.className} `\r\n\r\n    if (!value === (elClass.indexOf(` ${this.arg} `) > -1)) {\r\n      if (value) {\r\n        el.className = `${el.className} ${this.arg}`\r\n      } else {\r\n        el.className = elClass.replace(` ${this.arg} `, ' ').trim()\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's text value.\r\n  text: (el, value) => {\r\n    el.textContent = value != null ? value : ''\r\n  },\r\n\r\n  // Sets the element's HTML content.\r\n  html: (el, value) => {\r\n    el.innerHTML = value != null ? value : ''\r\n  },\r\n\r\n  // Shows the element when value is true.\r\n  show: (el, value) => {\r\n    el.style.display = value ? '' : 'none'\r\n  },\r\n\r\n  // Hides the element when value is true (negated version of `show` binder).\r\n  hide: (el, value) => {\r\n    el.style.display = value ? 'none' : ''\r\n  },\r\n\r\n  // Enables the element when value is true.\r\n  enabled: (el, value) => {\r\n    el.disabled = !value\r\n  },\r\n\r\n  // Disables the element when value is true (negated version of `enabled` binder).\r\n  disabled: (el, value) => {\r\n    el.disabled = !!value\r\n  },\r\n\r\n  // Checks a checkbox or radio input when the value is true. Also sets the model\r\n  // property when the input is checked or unchecked (two-way binder).\r\n  checked: {\r\n    publishes: true,\r\n    priority: 2000,\r\n\r\n    bind: function(el) {\r\n      var self = this;\r\n      if (!this.callback) {\r\n        this.callback = function () {\r\n          self.publish();\r\n        }\r\n      }\r\n      el.addEventListener('change', this.callback)\r\n    },\r\n\r\n    unbind: function(el) {\r\n      el.removeEventListener('change', this.callback)\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (el.type === 'radio') {\r\n        el.checked = getString(el.value) === getString(value)\r\n      } else {\r\n        el.checked = !!value\r\n      }\r\n    }\r\n  },\r\n\r\n  // Sets the element's value. Also sets the model property when the input changes\r\n  // (two-way binder).\r\n  value: {\r\n    publishes: true,\r\n    priority: 3000,\r\n\r\n    bind: function(el) {\r\n      this.isRadio = el.tagName === 'INPUT' && el.type === 'radio';\r\n      if (!this.isRadio) {\r\n        this.event = el.getAttribute('event-name') || (el.tagName === 'SELECT' ? 'change' : 'input')\r\n\r\n        var self = this;\r\n        if (!this.callback) {\r\n          this.callback = function () {\r\n            self.publish();\r\n          }\r\n        }\r\n\r\n        el.addEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    unbind: function(el) {\r\n      if (!this.isRadio) {\r\n        el.removeEventListener(this.event, this.callback)\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (this.isRadio) {\r\n        el.setAttribute('value', value)\r\n      } else {\r\n        if (el.type === 'select-multiple') {\r\n          if (value instanceof Array) {\r\n            for (let i = 0; i < el.length; i++) {\r\n              let option = el[i];\r\n              option.selected = value.indexOf(option.value) > -1\r\n            }\r\n          }\r\n        } else if (getString(value) !== getString(el.value)) {\r\n          el.value = value != null ? value : ''\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // Inserts and binds the element and it's child nodes into the DOM when true.\r\n  if: {\r\n    block: true,\r\n    priority: 4000,\r\n\r\n    bind: function(el) {\r\n      if (!this.marker) {\r\n        this.marker = document.createComment(' tinybind: ' + this.type + ' ' + this.keypath + ' ');\r\n        this.attached = false\r\n\r\n        el.parentNode.insertBefore(this.marker, el)\r\n        el.parentNode.removeChild(el)\r\n      } else if (this.bound === false && this.nested) {\r\n        this.nested.bind()\r\n      }\r\n      this.bound = true\r\n    },\r\n\r\n    unbind: function() {\r\n      if (this.nested) {\r\n        this.nested.unbind()\r\n        this.bound = false\r\n      }\r\n    },\r\n\r\n    routine: function(el, value) {\r\n      if (!!value !== this.attached) {\r\n        if (value) {\r\n\r\n          if (!this.nested) {\r\n            this.nested = new View(el, this.view.models, this.view.options)\r\n            this.nested.bind()\r\n          }\r\n\r\n          this.marker.parentNode.insertBefore(el, this.marker.nextSibling)\r\n          this.attached = true\r\n        } else {\r\n          el.parentNode.removeChild(el)\r\n          this.attached = false\r\n        }\r\n      }\r\n    },\r\n\r\n    update: function(models) {\r\n      if (this.nested) {\r\n        this.nested.update(models)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default binders\r\n","import tinybind from './tinybind'\r\nimport View from './view'\r\nimport {OPTIONS, EXTENSIONS} from './constants'\r\nimport adapter from './adapter'\r\nimport binders from './binders'\r\nimport Observer from './observer'\r\n\r\n// Returns the public interface.\r\n\r\ntinybind.binders = binders\r\ntinybind.adapters['.'] = adapter\r\n\r\n// Binds some data to a template / element. Returns a tinybind.View instance.\r\ntinybind.bind = (el, models, options) => {\r\n  let viewOptions = {}\r\n  models = models || {}\r\n  options = options || {}\r\n\r\n  EXTENSIONS.forEach(extensionType => {\r\n    viewOptions[extensionType] = Object.create(null)\r\n\r\n    if (options[extensionType]) {\r\n      Object.keys(options[extensionType]).forEach(key => {\r\n        viewOptions[extensionType][key] = options[extensionType][key]\r\n      })\r\n    }\r\n\r\n    Object.keys(tinybind[extensionType]).forEach(key => {\r\n      if (!viewOptions[extensionType][key]) {\r\n        viewOptions[extensionType][key] = tinybind[extensionType][key]\r\n      }\r\n    })\r\n  })\r\n\r\n  OPTIONS.forEach(option => {\r\n    let value = options[option]\r\n    viewOptions[option] = value != null ? value : tinybind[option]\r\n  })\r\n\r\n  viewOptions.starBinders = Object.keys(viewOptions.binders).filter(function (key) {\r\n    return key.indexOf('*') > 0\r\n  })\r\n\r\n  Observer.updateOptions(viewOptions)\r\n\r\n  let view = new View(el, models, viewOptions)\r\n  view.bind()\r\n  return view\r\n}\r\n\r\ntinybind.formatters.negate = tinybind.formatters.not = function (value) {\r\n  return !value;\r\n};\r\n\r\nexport default tinybind\r\n"],"names":["OPTIONS","EXTENSIONS","PRIMITIVE","KEYPATH","TEXT","BINDING","QUOTED_STR","parseType","string","type","value","test","slice","undefined","isNaN","Number","parseTemplate","template","delimiters","tokens","length","index","lastIndex","open","close","indexOf","push","substring","lastToken","trim","tinybind","binders","formatters","adapters","_prefix","_fullPrefix","prefix","templateDelimiters","rootInterface","preloadData","handler","context","ev","binding","call","view","models","fallbackBinder","el","setAttribute","removeAttribute","configure","options","Object","keys","forEach","option","key","isObject","obj","error","message","Error","interfaces","Observer","keypath","callback","objectPath","parse","getRootObject","target","realize","set","updateOptions","tokenize","root","current","i","path","chr","charAt","prototype","substr","pop","unreached","prev","token","get","splice","sync","next","oldValue","newValue","Function","Array","setValue","active","action","unobserve","rootProp","$parent","getInputValue","results","checked","selected","FORMATTER_ARGS","FORMATTER_SPLIT","Binding","binder","arg","formatterObservers","model","observe","parseTarget","observer","parseFormatterArguments","args","formatterIndex","map","ai","formattedValue","reduce","result","declaration","match","id","shift","formatter","processedArgs","read","eventHandler","fn","function","routineFn","routine","publish","reduceRight","split","getValue","bind","hasOwnProperty","unbind","fi","update","textBinder","node","data","DECLARATION_SPLIT","parseNode","block","nodeType","text","document","createTextNode","parentNode","insertBefore","buildBinding","removeChild","traverse","childNodes","bindingComparator","a","b","aPriority","priority","bPriority","trimStr","str","View","els","jquery","build","pipes","bindings","elements","len","sort","bindingPrefix","nodeName","attributes","bindInfos","starBinders","identifier","attribute","name","k","attr","bindInfo","publishes","ARRAY_METHODS","adapter","counter","weakmap","weakReference","defineProperty","__rv","callbacks","cleanupWeakReference","ref","pointers","stubFunction","original","response","apply","r","observeMutations","unobserveMutations","idx","desc","getOwnPropertyDescriptor","configurable","enumerable","cb","getString","toString","times","n","createView","anchorEl","cloneNode","marker","removeEventListener","addEventListener","createComment","iterated","collection","modelName","indexProp","getAttribute","previous","nextSibling","matchIndex","nextView","nextIndex","elClass","className","replace","textContent","html","innerHTML","show","style","display","hide","enabled","disabled","self","isRadio","tagName","event","if","attached","bound","nested","viewOptions","extensionType","create","filter","negate","not"],"mappings":"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"}